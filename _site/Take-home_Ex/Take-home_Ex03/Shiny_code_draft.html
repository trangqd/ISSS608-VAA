<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.26">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Quynh Trang Do">
<meta name="dcterms.date" content="2025-06-06">

<title>Take-home Exercise 3 – ISSS608-VAA</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-53f539a478d6ecd1be31ce9fd30fd81c.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-dfb324f25d9b1687192fa8be62ac8f9c.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="../../site_libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>

<link href="../../site_libs/vis-9.1.0/vis-network.min.css" rel="stylesheet">

<script src="../../site_libs/vis-9.1.0/vis-network.min.js"></script>

<script src="../../site_libs/visNetwork-binding-2.1.2/visNetwork.js"></script>

<link href="../../site_libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">



<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">ISSS608-VAA</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-hands-on-exercise" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Hands-on Exercise</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-hands-on-exercise">    
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex01/Hands-on_Ex01.html">
 <span class="dropdown-text">Hands-on Exercise 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex02/Hands-on_Ex02.html">
 <span class="dropdown-text">Hands-on Exercise 2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex03/Hands-on_Ex03.html">
 <span class="dropdown-text">Hands-on Exercise 3</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex04/Hands-on_Ex04.html">
 <span class="dropdown-text">Hands-on Exercise 4</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex05/Hands-on_Ex05.html">
 <span class="dropdown-text">Hands-on Exercise 5</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex06/Hands-on_Ex06.html">
 <span class="dropdown-text">Hands-on Exercise 6</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex08/Hands-on_Ex08_P1.html">
 <span class="dropdown-text">Hands-on Exercise 8 (P1)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex08/Hands-on_Ex08_P2.html">
 <span class="dropdown-text">Hands-on Exercise 8 (P2)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Hands-on_Ex/Hands-on_Ex08/Hands-on_Ex08_P3.html">
 <span class="dropdown-text">Hands-on Exercise 8 (P3)</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-in-class-exercise" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">In-class Exercise</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-in-class-exercise">    
        <li>
    <a class="dropdown-item" href="../../VAST/MC1.html">
 <span class="dropdown-text">In-class Exercise 5</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-take-home-exercise" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Take-home Exercise</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-take-home-exercise">    
        <li>
    <a class="dropdown-item" href="../../Take-home_Ex/Take-home_Ex01/Take-home_Ex01.html">
 <span class="dropdown-text">Take-home Exercise 1 (Part 1)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Take-home_Ex/Take-home_Ex01/Take-home_Ex01_P2.html">
 <span class="dropdown-text">Take-home Exercise 1 (Part 2)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Take-home_Ex/Take-home_Ex02/Take-home_Ex02.html">
 <span class="dropdown-text">Take-home Exercise 2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Take-home_Ex/Take-home_Ex03/Take-home_Ex03.html">
 <span class="dropdown-text">Take-home Exercise 3</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#load-packages" id="toc-load-packages" class="nav-link active" data-scroll-target="#load-packages">Load packages</a></li>
  <li><a href="#import-data" id="toc-import-data" class="nav-link" data-scroll-target="#import-data">Import data</a></li>
  <li><a href="#data-cleaning-and-wrangling" id="toc-data-cleaning-and-wrangling" class="nav-link" data-scroll-target="#data-cleaning-and-wrangling">Data Cleaning and Wrangling</a>
  <ul class="collapse">
  <li><a href="#for-nodes" id="toc-for-nodes" class="nav-link" data-scroll-target="#for-nodes">For nodes</a></li>
  <li><a href="#for-edges" id="toc-for-edges" class="nav-link" data-scroll-target="#for-edges">For edges</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Take-home Exercise 3</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Quynh Trang Do </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">June 6, 2025</p>
    </div>
  </div>
  
    <div>
    <div class="quarto-title-meta-heading">Modified</div>
    <div class="quarto-title-meta-contents">
      <p class="date-modified">June 11, 2025</p>
    </div>
  </div>
    
  </div>
  


</header>


<section id="load-packages" class="level1">
<h1>Load packages</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(tidyverse, jsonlite, dplyr, igraph,</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>               tidygraph, ggraph, scales, visNetwork,</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>               SmartEDA, widyr, ggforce, tidytext)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="import-data" class="level1">
<h1>Import data</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>MC3 <span class="ot">&lt;-</span> <span class="fu">fromJSON</span>(<span class="st">"data/MC3_graph.json"</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>MC3_schema <span class="ot">&lt;-</span> <span class="fu">fromJSON</span>(<span class="st">"data/MC3_schema.json"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Quick check on the imported data</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(MC3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of 5
 $ directed  : logi TRUE
 $ multigraph: logi FALSE
 $ graph     :List of 4
  ..$ mode        : chr "static"
  ..$ edge_default: Named list()
  ..$ node_default: Named list()
  ..$ name        : chr "VAST_MC3_Knowledge_Graph"
 $ nodes     :'data.frame': 1159 obs. of  31 variables:
  ..$ type             : chr [1:1159] "Entity" "Entity" "Entity" "Entity" ...
  ..$ label            : chr [1:1159] "Sam" "Kelly" "Nadia Conti" "Elise" ...
  ..$ name             : chr [1:1159] "Sam" "Kelly" "Nadia Conti" "Elise" ...
  ..$ sub_type         : chr [1:1159] "Person" "Person" "Person" "Person" ...
  ..$ id               : chr [1:1159] "Sam" "Kelly" "Nadia Conti" "Elise" ...
  ..$ timestamp        : chr [1:1159] NA NA NA NA ...
  ..$ monitoring_type  : chr [1:1159] NA NA NA NA ...
  ..$ findings         : chr [1:1159] NA NA NA NA ...
  ..$ content          : chr [1:1159] NA NA NA NA ...
  ..$ assessment_type  : chr [1:1159] NA NA NA NA ...
  ..$ results          : chr [1:1159] NA NA NA NA ...
  ..$ movement_type    : chr [1:1159] NA NA NA NA ...
  ..$ destination      : chr [1:1159] NA NA NA NA ...
  ..$ enforcement_type : chr [1:1159] NA NA NA NA ...
  ..$ outcome          : chr [1:1159] NA NA NA NA ...
  ..$ activity_type    : chr [1:1159] NA NA NA NA ...
  ..$ participants     : int [1:1159] NA NA NA NA NA NA NA NA NA NA ...
  ..$ thing_collected  :'data.frame':   1159 obs. of  2 variables:
  .. ..$ type: chr [1:1159] NA NA NA NA ...
  .. ..$ name: chr [1:1159] NA NA NA NA ...
  ..$ reference        : chr [1:1159] NA NA NA NA ...
  ..$ date             : chr [1:1159] NA NA NA NA ...
  ..$ time             : chr [1:1159] NA NA NA NA ...
  ..$ friendship_type  : chr [1:1159] NA NA NA NA ...
  ..$ permission_type  : chr [1:1159] NA NA NA NA ...
  ..$ start_date       : chr [1:1159] NA NA NA NA ...
  ..$ end_date         : chr [1:1159] NA NA NA NA ...
  ..$ report_type      : chr [1:1159] NA NA NA NA ...
  ..$ submission_date  : chr [1:1159] NA NA NA NA ...
  ..$ jurisdiction_type: chr [1:1159] NA NA NA NA ...
  ..$ authority_level  : chr [1:1159] NA NA NA NA ...
  ..$ coordination_type: chr [1:1159] NA NA NA NA ...
  ..$ operational_role : chr [1:1159] NA NA NA NA ...
 $ edges     :'data.frame': 3226 obs. of  5 variables:
  ..$ id         : chr [1:3226] "2" "3" "5" "3013" ...
  ..$ is_inferred: logi [1:3226] TRUE FALSE TRUE TRUE TRUE TRUE ...
  ..$ source     : chr [1:3226] "Sam" "Sam" "Sam" "Sam" ...
  ..$ target     : chr [1:3226] "Relationship_Suspicious_217" "Event_Communication_370" "Event_Assessment_600" "Relationship_Colleagues_430" ...
  ..$ type       : chr [1:3226] NA "sent" NA NA ...</code></pre>
</div>
</div>
<p><strong>Extract the node and edge tables</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>mc3_nodes <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(MC3<span class="sc">$</span>nodes)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>mc3_edges <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(MC3<span class="sc">$</span>edges)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="data-cleaning-and-wrangling" class="level1">
<h1>Data Cleaning and Wrangling</h1>
<section id="for-nodes" class="level2">
<h2 class="anchored" data-anchor-id="for-nodes">For nodes</h2>
<p>The code chunk below is used to convert values in id field into character data type, exclude records with ID value are NA, exclude records with similar ID values, exclude thing_collected field, and save the cleaned tibble dataframe into a new tibble datatable called mc3_nodes_cleaned.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>mc3_nodes_cleaned <span class="ot">&lt;-</span> mc3_nodes <span class="sc">%&gt;%</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">id =</span> <span class="fu">as.character</span>(id)) <span class="sc">%&gt;%</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(id)) <span class="sc">%&gt;%</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(id, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>thing_collected)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="for-edges" class="level2">
<h2 class="anchored" data-anchor-id="for-edges">For edges</h2>
<p>The code chunk below is used to rename source and target fields to from_id and to_id respectively, convert values in from_id and to_id fields to character data type, exclude values in from_id and to_id which not found in the id field of mc3_nodes_cleaned, exclude records whereby from_id and/or to_id values are missing, and save the cleaned tibble dataframe and called it mc3_edges_cleaned.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>mc3_edges_cleaned <span class="ot">&lt;-</span> mc3_edges <span class="sc">%&gt;%</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">from_id =</span> source, </span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">to_id =</span> target) <span class="sc">%&gt;%</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(from_id, to_id), </span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>                as.character)) <span class="sc">%&gt;%</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(from_id <span class="sc">%in%</span> mc3_nodes_cleaned<span class="sc">$</span>id, </span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>         to_id <span class="sc">%in%</span> mc3_nodes_cleaned<span class="sc">$</span>id) <span class="sc">%&gt;%</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(from_id), <span class="sc">!</span><span class="fu">is.na</span>(to_id))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next, create mapping of character id in mc3_nodes_cleaned to row index.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>node_index_lookup <span class="ot">&lt;-</span> mc3_nodes_cleaned <span class="sc">%&gt;%</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">.row_id =</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id, .row_id)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next, join and convert from_id and to_id to integer indices. At the same time, drop rows with unmatched nodes.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>mc3_edges_indexed <span class="ot">&lt;-</span> mc3_edges_cleaned <span class="sc">%&gt;%</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(node_index_lookup, </span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"from_id"</span> <span class="ot">=</span> <span class="st">"id"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">from =</span> .row_id) <span class="sc">%&gt;%</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(node_index_lookup, </span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"to_id"</span> <span class="ot">=</span> <span class="st">"id"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">to =</span> .row_id) <span class="sc">%&gt;%</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(from, to, is_inferred, type) <span class="sc">%&gt;%</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(from) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(to))  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next, subset nodes to only those referenced by edges.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>used_node_indices <span class="ot">&lt;-</span> <span class="fu">sort</span>(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unique</span>(<span class="fu">c</span>(mc3_edges_indexed<span class="sc">$</span>from, </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>           mc3_edges_indexed<span class="sc">$</span>to)))</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>mc3_nodes_final <span class="ot">&lt;-</span> mc3_nodes_cleaned <span class="sc">%&gt;%</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(used_node_indices) <span class="sc">%&gt;%</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">new_index =</span> <span class="fu">row_number</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then, rebuild lookup from old index to new index.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>old_to_new_index <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">old_index =</span> used_node_indices,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">new_index =</span> <span class="fu">seq_along</span>(</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    used_node_indices))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Finally, update edge indices to match new node table.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>mc3_edges_final <span class="ot">&lt;-</span> mc3_edges_indexed <span class="sc">%&gt;%</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(old_to_new_index, </span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"from"</span> <span class="ot">=</span> <span class="st">"old_index"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">from_new =</span> new_index) <span class="sc">%&gt;%</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(old_to_new_index, </span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"to"</span> <span class="ot">=</span> <span class="st">"old_index"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">to_new =</span> new_index) <span class="sc">%&gt;%</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="at">from =</span> from_new, <span class="at">to =</span> to_new, </span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>         is_inferred, type)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>subtype_map <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">Coordinates =</span> <span class="st">"Operational"</span>,</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">AccessPermission =</span> <span class="st">"Operational"</span>,</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Operates =</span> <span class="st">"Operational"</span>,</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Jurisdiction =</span> <span class="st">"Operational"</span>,</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">Reports =</span> <span class="st">"Operational"</span>,</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">Colleagues =</span> <span class="st">"Affiliates"</span>,</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">Friends =</span> <span class="st">"Affiliates"</span>,</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">Unfriendly =</span> <span class="st">"Unfriendly"</span>,</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">Suspicious =</span> <span class="st">"Suspicious"</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>undirected_types <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Friends"</span>, <span class="st">"Colleagues"</span>)</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a><span class="co"># ─────────────────────────────────────────────────────────────</span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Filter nodes</span></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a><span class="co"># ─────────────────────────────────────────────────────────────</span></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>event_ids <span class="ot">&lt;-</span> mc3_nodes_final <span class="sc">%&gt;%</span> <span class="fu">filter</span>(type <span class="sc">==</span> <span class="st">"Event"</span>) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(new_index)</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>location_ids <span class="ot">&lt;-</span> mc3_nodes_final <span class="sc">%&gt;%</span> <span class="fu">filter</span>(sub_type <span class="sc">==</span> <span class="st">"Location"</span>) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(new_index)</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>blocked_ids <span class="ot">&lt;-</span> <span class="fu">c</span>(event_ids, location_ids)</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>node_lookup <span class="ot">&lt;-</span> mc3_nodes_final <span class="sc">%&gt;%</span> </span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>new_index <span class="sc">%in%</span> blocked_ids) <span class="sc">%&gt;%</span> </span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(new_index, type, sub_type, label)</span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a><span class="co"># ─────────────────────────────────────────────────────────────</span></span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Relationship nodes (no color use)</span></span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a><span class="co"># ─────────────────────────────────────────────────────────────</span></span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a>rel_nodes <span class="ot">&lt;-</span> node_lookup <span class="sc">%&gt;%</span></span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(type <span class="sc">==</span> <span class="st">"Relationship"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">rel_subtype =</span> sub_type,</span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">big_group =</span> <span class="fu">ifelse</span>(rel_subtype <span class="sc">%in%</span> <span class="fu">names</span>(subtype_map),</span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a>                       subtype_map[rel_subtype],</span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a>                       rel_subtype),</span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">rel_id =</span> <span class="fu">as.character</span>(new_index)</span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb13-37"><a href="#cb13-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(rel_id, rel_subtype, big_group)</span>
<span id="cb13-38"><a href="#cb13-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-39"><a href="#cb13-39" aria-hidden="true" tabindex="-1"></a>rel_ids <span class="ot">&lt;-</span> rel_nodes<span class="sc">$</span>rel_id</span>
<span id="cb13-40"><a href="#cb13-40" aria-hidden="true" tabindex="-1"></a>nondir_rel_ids <span class="ot">&lt;-</span> rel_nodes <span class="sc">%&gt;%</span> <span class="fu">filter</span>(rel_subtype <span class="sc">%in%</span> undirected_types) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(rel_id)</span>
<span id="cb13-41"><a href="#cb13-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-42"><a href="#cb13-42" aria-hidden="true" tabindex="-1"></a><span class="co"># ─────────────────────────────────────────────────────────────</span></span>
<span id="cb13-43"><a href="#cb13-43" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. All edges</span></span>
<span id="cb13-44"><a href="#cb13-44" aria-hidden="true" tabindex="-1"></a><span class="co"># ─────────────────────────────────────────────────────────────</span></span>
<span id="cb13-45"><a href="#cb13-45" aria-hidden="true" tabindex="-1"></a>edges_all <span class="ot">&lt;-</span> mc3_edges_final <span class="sc">%&gt;%</span> </span>
<span id="cb13-46"><a href="#cb13-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(from <span class="sc">%in%</span> node_lookup<span class="sc">$</span>new_index <span class="sc">|</span> to <span class="sc">%in%</span> node_lookup<span class="sc">$</span>new_index) <span class="sc">%&gt;%</span></span>
<span id="cb13-47"><a href="#cb13-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>from <span class="sc">%in%</span> blocked_ids, <span class="sc">!</span>to <span class="sc">%in%</span> blocked_ids) <span class="sc">%&gt;%</span></span>
<span id="cb13-48"><a href="#cb13-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(from, to), as.character))</span>
<span id="cb13-49"><a href="#cb13-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-50"><a href="#cb13-50" aria-hidden="true" tabindex="-1"></a>undir_edges <span class="ot">&lt;-</span> edges_all <span class="sc">%&gt;%</span> </span>
<span id="cb13-51"><a href="#cb13-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(to <span class="sc">%in%</span> nondir_rel_ids) <span class="sc">%&gt;%</span> </span>
<span id="cb13-52"><a href="#cb13-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(<span class="at">from =</span> to, <span class="at">to =</span> from, <span class="at">direction =</span> <span class="st">"undirected"</span>)</span>
<span id="cb13-53"><a href="#cb13-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-54"><a href="#cb13-54" aria-hidden="true" tabindex="-1"></a>edges_all <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb13-55"><a href="#cb13-55" aria-hidden="true" tabindex="-1"></a>  edges_all <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">direction =</span> <span class="st">"directed"</span>),</span>
<span id="cb13-56"><a href="#cb13-56" aria-hidden="true" tabindex="-1"></a>  undir_edges</span>
<span id="cb13-57"><a href="#cb13-57" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb13-58"><a href="#cb13-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-59"><a href="#cb13-59" aria-hidden="true" tabindex="-1"></a><span class="co"># ─────────────────────────────────────────────────────────────</span></span>
<span id="cb13-60"><a href="#cb13-60" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. Entity–Relationship table</span></span>
<span id="cb13-61"><a href="#cb13-61" aria-hidden="true" tabindex="-1"></a><span class="co"># ─────────────────────────────────────────────────────────────</span></span>
<span id="cb13-62"><a href="#cb13-62" aria-hidden="true" tabindex="-1"></a>entity_rel_tbl <span class="ot">&lt;-</span> edges_all <span class="sc">%&gt;%</span></span>
<span id="cb13-63"><a href="#cb13-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(from <span class="sc">%in%</span> rel_ids <span class="sc">|</span> to <span class="sc">%in%</span> rel_ids) <span class="sc">%&gt;%</span></span>
<span id="cb13-64"><a href="#cb13-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb13-65"><a href="#cb13-65" aria-hidden="true" tabindex="-1"></a>    <span class="at">rel_id =</span> <span class="fu">if_else</span>(from <span class="sc">%in%</span> rel_ids, from, to),</span>
<span id="cb13-66"><a href="#cb13-66" aria-hidden="true" tabindex="-1"></a>    <span class="at">entity =</span> <span class="fu">if_else</span>(from <span class="sc">%in%</span> rel_ids, to, from)</span>
<span id="cb13-67"><a href="#cb13-67" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb13-68"><a href="#cb13-68" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(rel_id, entity)</span>
<span id="cb13-69"><a href="#cb13-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-70"><a href="#cb13-70" aria-hidden="true" tabindex="-1"></a><span class="co"># ─────────────────────────────────────────────────────────────</span></span>
<span id="cb13-71"><a href="#cb13-71" aria-hidden="true" tabindex="-1"></a><span class="co"># 5. Create and de-duplicate triplets</span></span>
<span id="cb13-72"><a href="#cb13-72" aria-hidden="true" tabindex="-1"></a><span class="co"># ─────────────────────────────────────────────────────────────</span></span>
<span id="cb13-73"><a href="#cb13-73" aria-hidden="true" tabindex="-1"></a>triplets <span class="ot">&lt;-</span> entity_rel_tbl <span class="sc">%&gt;%</span></span>
<span id="cb13-74"><a href="#cb13-74" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(rel_nodes, <span class="at">by =</span> <span class="st">"rel_id"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb13-75"><a href="#cb13-75" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(rel_id) <span class="sc">%&gt;%</span></span>
<span id="cb13-76"><a href="#cb13-76" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">n_distinct</span>(entity) <span class="sc">==</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb13-77"><a href="#cb13-77" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb13-78"><a href="#cb13-78" aria-hidden="true" tabindex="-1"></a>    <span class="at">entities =</span> <span class="fu">list</span>(<span class="fu">sort</span>(<span class="fu">unique</span>(entity))),</span>
<span id="cb13-79"><a href="#cb13-79" aria-hidden="true" tabindex="-1"></a>    <span class="at">rel_subtype =</span> <span class="fu">first</span>(rel_subtype),</span>
<span id="cb13-80"><a href="#cb13-80" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb13-81"><a href="#cb13-81" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb13-82"><a href="#cb13-82" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb13-83"><a href="#cb13-83" aria-hidden="true" tabindex="-1"></a>    <span class="at">e1 =</span> <span class="fu">map_chr</span>(entities, <span class="sc">~</span>.x[<span class="dv">1</span>]),</span>
<span id="cb13-84"><a href="#cb13-84" aria-hidden="true" tabindex="-1"></a>    <span class="at">e2 =</span> <span class="fu">map_chr</span>(entities, <span class="sc">~</span>.x[<span class="dv">2</span>])</span>
<span id="cb13-85"><a href="#cb13-85" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb13-86"><a href="#cb13-86" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pair_id =</span> <span class="fu">paste</span>(<span class="fu">pmin</span>(e1, e2), <span class="fu">pmax</span>(e1, e2), <span class="at">sep =</span> <span class="st">"_"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb13-87"><a href="#cb13-87" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(pair_id, rel_subtype, rel_id) <span class="sc">%&gt;%</span></span>
<span id="cb13-88"><a href="#cb13-88" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(pair_id) <span class="sc">%&gt;%</span></span>
<span id="cb13-89"><a href="#cb13-89" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb13-90"><a href="#cb13-90" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb13-91"><a href="#cb13-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-92"><a href="#cb13-92" aria-hidden="true" tabindex="-1"></a><span class="co"># ─────────────────────────────────────────────────────────────</span></span>
<span id="cb13-93"><a href="#cb13-93" aria-hidden="true" tabindex="-1"></a><span class="co"># 6. Rebuild edge list</span></span>
<span id="cb13-94"><a href="#cb13-94" aria-hidden="true" tabindex="-1"></a><span class="co"># ─────────────────────────────────────────────────────────────</span></span>
<span id="cb13-95"><a href="#cb13-95" aria-hidden="true" tabindex="-1"></a>edges_all <span class="ot">&lt;-</span> triplets <span class="sc">%&gt;%</span> </span>
<span id="cb13-96"><a href="#cb13-96" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rel_type =</span> <span class="fu">if_else</span>(rel_subtype <span class="sc">%in%</span> undirected_types, <span class="st">"undirected"</span>, <span class="st">"directed"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb13-97"><a href="#cb13-97" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">c</span>(e1, e2), <span class="at">names_to =</span> <span class="st">"end"</span>, <span class="at">values_to =</span> <span class="st">"entity"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb13-98"><a href="#cb13-98" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(</span>
<span id="cb13-99"><a href="#cb13-99" aria-hidden="true" tabindex="-1"></a>    <span class="at">from =</span> <span class="fu">if_else</span>(end <span class="sc">==</span> <span class="st">"e1"</span>, entity, rel_id),</span>
<span id="cb13-100"><a href="#cb13-100" aria-hidden="true" tabindex="-1"></a>    <span class="at">to =</span> <span class="fu">if_else</span>(end <span class="sc">==</span> <span class="st">"e1"</span>, rel_id, entity),</span>
<span id="cb13-101"><a href="#cb13-101" aria-hidden="true" tabindex="-1"></a>    <span class="at">direction =</span> rel_type</span>
<span id="cb13-102"><a href="#cb13-102" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb13-103"><a href="#cb13-103" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>()</span>
<span id="cb13-104"><a href="#cb13-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-105"><a href="#cb13-105" aria-hidden="true" tabindex="-1"></a><span class="co"># ─────────────────────────────────────────────────────────────</span></span>
<span id="cb13-106"><a href="#cb13-106" aria-hidden="true" tabindex="-1"></a><span class="co"># 7. Node table</span></span>
<span id="cb13-107"><a href="#cb13-107" aria-hidden="true" tabindex="-1"></a><span class="co"># ─────────────────────────────────────────────────────────────</span></span>
<span id="cb13-108"><a href="#cb13-108" aria-hidden="true" tabindex="-1"></a>used_ids <span class="ot">&lt;-</span> <span class="fu">unique</span>(<span class="fu">c</span>(edges_all<span class="sc">$</span>from, edges_all<span class="sc">$</span>to))</span>
<span id="cb13-109"><a href="#cb13-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-110"><a href="#cb13-110" aria-hidden="true" tabindex="-1"></a>nodes_tbl <span class="ot">&lt;-</span> mc3_nodes_final <span class="sc">%&gt;%</span> </span>
<span id="cb13-111"><a href="#cb13-111" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(new_index <span class="sc">%in%</span> used_ids) <span class="sc">%&gt;%</span> </span>
<span id="cb13-112"><a href="#cb13-112" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb13-113"><a href="#cb13-113" aria-hidden="true" tabindex="-1"></a>    <span class="at">vis_type =</span> <span class="fu">case_when</span>(</span>
<span id="cb13-114"><a href="#cb13-114" aria-hidden="true" tabindex="-1"></a>      type <span class="sc">==</span> <span class="st">"Relationship"</span> <span class="sc">~</span> <span class="st">"Relationship"</span>,</span>
<span id="cb13-115"><a href="#cb13-115" aria-hidden="true" tabindex="-1"></a>      sub_type <span class="sc">==</span> <span class="st">"Person"</span> <span class="sc">~</span> <span class="st">"Person"</span>,</span>
<span id="cb13-116"><a href="#cb13-116" aria-hidden="true" tabindex="-1"></a>      sub_type <span class="sc">==</span> <span class="st">"Organization"</span> <span class="sc">~</span> <span class="st">"Organization"</span>,</span>
<span id="cb13-117"><a href="#cb13-117" aria-hidden="true" tabindex="-1"></a>      sub_type <span class="sc">==</span> <span class="st">"Vessel"</span> <span class="sc">~</span> <span class="st">"Vessel"</span>, </span>
<span id="cb13-118"><a href="#cb13-118" aria-hidden="true" tabindex="-1"></a>      sub_type <span class="sc">==</span> <span class="st">"Group"</span> <span class="sc">~</span> <span class="st">"Group"</span>,</span>
<span id="cb13-119"><a href="#cb13-119" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Other"</span></span>
<span id="cb13-120"><a href="#cb13-120" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb13-121"><a href="#cb13-121" aria-hidden="true" tabindex="-1"></a>    <span class="at">new_index =</span> <span class="fu">as.character</span>(new_index)</span>
<span id="cb13-122"><a href="#cb13-122" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb13-123"><a href="#cb13-123" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(rel_nodes <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="at">node_id =</span> rel_id, big_group), </span>
<span id="cb13-124"><a href="#cb13-124" aria-hidden="true" tabindex="-1"></a>            <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"new_index"</span> <span class="ot">=</span> <span class="st">"node_id"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb13-125"><a href="#cb13-125" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb13-126"><a href="#cb13-126" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="fu">if_else</span>(vis_type <span class="sc">==</span> <span class="st">"Relationship"</span>, big_group, label)</span>
<span id="cb13-127"><a href="#cb13-127" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb13-128"><a href="#cb13-128" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="at">node_id =</span> new_index, label, vis_type) <span class="sc">%&gt;%</span></span>
<span id="cb13-129"><a href="#cb13-129" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">row_id =</span> <span class="fu">row_number</span>())</span>
<span id="cb13-130"><a href="#cb13-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-131"><a href="#cb13-131" aria-hidden="true" tabindex="-1"></a><span class="co"># ─────────────────────────────────────────────────────────────</span></span>
<span id="cb13-132"><a href="#cb13-132" aria-hidden="true" tabindex="-1"></a><span class="co"># 8. Format for visNetwork</span></span>
<span id="cb13-133"><a href="#cb13-133" aria-hidden="true" tabindex="-1"></a><span class="co"># ─────────────────────────────────────────────────────────────</span></span>
<span id="cb13-134"><a href="#cb13-134" aria-hidden="true" tabindex="-1"></a>id_map <span class="ot">&lt;-</span> nodes_tbl <span class="sc">%&gt;%</span> <span class="fu">select</span>(node_id, row_id)</span>
<span id="cb13-135"><a href="#cb13-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-136"><a href="#cb13-136" aria-hidden="true" tabindex="-1"></a>vis_edges <span class="ot">&lt;-</span> edges_all <span class="sc">%&gt;%</span> </span>
<span id="cb13-137"><a href="#cb13-137" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(id_map, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"from"</span> <span class="ot">=</span> <span class="st">"node_id"</span>)) <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">.from =</span> row_id) <span class="sc">%&gt;%</span> </span>
<span id="cb13-138"><a href="#cb13-138" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(id_map, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"to"</span> <span class="ot">=</span> <span class="st">"node_id"</span>)) <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">.to =</span> row_id) <span class="sc">%&gt;%</span> </span>
<span id="cb13-139"><a href="#cb13-139" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(</span>
<span id="cb13-140"><a href="#cb13-140" aria-hidden="true" tabindex="-1"></a>    <span class="at">from =</span> .from, </span>
<span id="cb13-141"><a href="#cb13-141" aria-hidden="true" tabindex="-1"></a>    <span class="at">to =</span> .to,</span>
<span id="cb13-142"><a href="#cb13-142" aria-hidden="true" tabindex="-1"></a>    <span class="at">arrows =</span> <span class="fu">ifelse</span>(direction <span class="sc">==</span> <span class="st">"undirected"</span>, <span class="st">""</span>, <span class="st">"to"</span>),</span>
<span id="cb13-143"><a href="#cb13-143" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"grey"</span></span>
<span id="cb13-144"><a href="#cb13-144" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb13-145"><a href="#cb13-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-146"><a href="#cb13-146" aria-hidden="true" tabindex="-1"></a><span class="co"># ─────────────────────────────────────────────────────────────</span></span>
<span id="cb13-147"><a href="#cb13-147" aria-hidden="true" tabindex="-1"></a><span class="co"># 9. Colors and shapes (only by vis_type)</span></span>
<span id="cb13-148"><a href="#cb13-148" aria-hidden="true" tabindex="-1"></a><span class="co"># ─────────────────────────────────────────────────────────────</span></span>
<span id="cb13-149"><a href="#cb13-149" aria-hidden="true" tabindex="-1"></a>palette <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb13-150"><a href="#cb13-150" aria-hidden="true" tabindex="-1"></a>  <span class="at">Person =</span> <span class="st">"orange"</span>,</span>
<span id="cb13-151"><a href="#cb13-151" aria-hidden="true" tabindex="-1"></a>  <span class="at">Organization =</span> <span class="st">"red"</span>,</span>
<span id="cb13-152"><a href="#cb13-152" aria-hidden="true" tabindex="-1"></a>  <span class="at">Vessel =</span> <span class="st">"forestgreen"</span>,</span>
<span id="cb13-153"><a href="#cb13-153" aria-hidden="true" tabindex="-1"></a>  <span class="at">Group =</span> <span class="st">"orchid"</span>,</span>
<span id="cb13-154"><a href="#cb13-154" aria-hidden="true" tabindex="-1"></a>  <span class="at">Relationship =</span> <span class="st">"skyblue"</span></span>
<span id="cb13-155"><a href="#cb13-155" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb13-156"><a href="#cb13-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-157"><a href="#cb13-157" aria-hidden="true" tabindex="-1"></a>shapes <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb13-158"><a href="#cb13-158" aria-hidden="true" tabindex="-1"></a>  <span class="at">Person =</span> <span class="st">"dot"</span>,</span>
<span id="cb13-159"><a href="#cb13-159" aria-hidden="true" tabindex="-1"></a>  <span class="at">Organization =</span> <span class="st">"diamond"</span>, </span>
<span id="cb13-160"><a href="#cb13-160" aria-hidden="true" tabindex="-1"></a>  <span class="at">Vessel =</span> <span class="st">"triangle"</span>,</span>
<span id="cb13-161"><a href="#cb13-161" aria-hidden="true" tabindex="-1"></a>  <span class="at">Group =</span> <span class="st">"star"</span>,</span>
<span id="cb13-162"><a href="#cb13-162" aria-hidden="true" tabindex="-1"></a>  <span class="at">Relationship =</span> <span class="st">"box"</span></span>
<span id="cb13-163"><a href="#cb13-163" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb13-164"><a href="#cb13-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-165"><a href="#cb13-165" aria-hidden="true" tabindex="-1"></a><span class="co"># ─────────────────────────────────────────────────────────────</span></span>
<span id="cb13-166"><a href="#cb13-166" aria-hidden="true" tabindex="-1"></a><span class="co"># 10. Build vis_nodes table</span></span>
<span id="cb13-167"><a href="#cb13-167" aria-hidden="true" tabindex="-1"></a><span class="co"># ─────────────────────────────────────────────────────────────</span></span>
<span id="cb13-168"><a href="#cb13-168" aria-hidden="true" tabindex="-1"></a>vis_nodes <span class="ot">&lt;-</span> nodes_tbl <span class="sc">%&gt;%</span></span>
<span id="cb13-169"><a href="#cb13-169" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(rel_nodes <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">node_id =</span> rel_id), <span class="at">by =</span> <span class="st">"node_id"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb13-170"><a href="#cb13-170" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb13-171"><a href="#cb13-171" aria-hidden="true" tabindex="-1"></a>    <span class="at">group =</span> vis_type,</span>
<span id="cb13-172"><a href="#cb13-172" aria-hidden="true" tabindex="-1"></a>    <span class="at">shape =</span> shapes[vis_type],</span>
<span id="cb13-173"><a href="#cb13-173" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> palette[vis_type],</span>
<span id="cb13-174"><a href="#cb13-174" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="fu">if_else</span>(vis_type <span class="sc">==</span> <span class="st">"Relationship"</span>, rel_subtype, <span class="cn">NA_character_</span>)  <span class="co"># Tooltip for rel</span></span>
<span id="cb13-175"><a href="#cb13-175" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb13-176"><a href="#cb13-176" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(</span>
<span id="cb13-177"><a href="#cb13-177" aria-hidden="true" tabindex="-1"></a>    <span class="at">id =</span> row_id,</span>
<span id="cb13-178"><a href="#cb13-178" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> <span class="fu">if_else</span>(group <span class="sc">==</span> <span class="st">"Relationship"</span>, big_group, label),</span>
<span id="cb13-179"><a href="#cb13-179" aria-hidden="true" tabindex="-1"></a>    <span class="at">group =</span> group,</span>
<span id="cb13-180"><a href="#cb13-180" aria-hidden="true" tabindex="-1"></a>    <span class="at">shape =</span> shape,</span>
<span id="cb13-181"><a href="#cb13-181" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> color,</span>
<span id="cb13-182"><a href="#cb13-182" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> title</span>
<span id="cb13-183"><a href="#cb13-183" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb13-184"><a href="#cb13-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-185"><a href="#cb13-185" aria-hidden="true" tabindex="-1"></a><span class="co"># ─────────────────────────────────────────────────────────────</span></span>
<span id="cb13-186"><a href="#cb13-186" aria-hidden="true" tabindex="-1"></a><span class="co"># 11. Final visNetwork graph</span></span>
<span id="cb13-187"><a href="#cb13-187" aria-hidden="true" tabindex="-1"></a><span class="co"># ─────────────────────────────────────────────────────────────</span></span>
<span id="cb13-188"><a href="#cb13-188" aria-hidden="true" tabindex="-1"></a><span class="fu">visNetwork</span>(vis_nodes, vis_edges, <span class="at">width =</span> <span class="st">"100%"</span>, <span class="at">height =</span> <span class="st">"800px"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb13-189"><a href="#cb13-189" aria-hidden="true" tabindex="-1"></a>  <span class="fu">visNodes</span>(<span class="at">font =</span> <span class="fu">list</span>(<span class="at">size =</span> <span class="dv">18</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb13-190"><a href="#cb13-190" aria-hidden="true" tabindex="-1"></a>  <span class="fu">visEdges</span>(<span class="at">smooth =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb13-191"><a href="#cb13-191" aria-hidden="true" tabindex="-1"></a>  <span class="fu">visOptions</span>(</span>
<span id="cb13-192"><a href="#cb13-192" aria-hidden="true" tabindex="-1"></a>    <span class="at">highlightNearest =</span> <span class="fu">list</span>(<span class="at">enabled =</span> <span class="cn">TRUE</span>, <span class="at">degree =</span> <span class="dv">2</span>, <span class="at">hover =</span> <span class="cn">TRUE</span>),</span>
<span id="cb13-193"><a href="#cb13-193" aria-hidden="true" tabindex="-1"></a>    <span class="at">nodesIdSelection =</span> <span class="fu">list</span>(</span>
<span id="cb13-194"><a href="#cb13-194" aria-hidden="true" tabindex="-1"></a>      <span class="at">enabled =</span> <span class="cn">TRUE</span>,</span>
<span id="cb13-195"><a href="#cb13-195" aria-hidden="true" tabindex="-1"></a>      <span class="at">values =</span> vis_nodes <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span>group <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Relationship"</span>, <span class="st">"Other"</span>)) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(id)</span>
<span id="cb13-196"><a href="#cb13-196" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb13-197"><a href="#cb13-197" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb13-198"><a href="#cb13-198" aria-hidden="true" tabindex="-1"></a>  <span class="fu">visLegend</span>(</span>
<span id="cb13-199"><a href="#cb13-199" aria-hidden="true" tabindex="-1"></a>    <span class="at">addNodes =</span> <span class="fu">data.frame</span>(</span>
<span id="cb13-200"><a href="#cb13-200" aria-hidden="true" tabindex="-1"></a>      <span class="at">label =</span> <span class="fu">names</span>(palette),</span>
<span id="cb13-201"><a href="#cb13-201" aria-hidden="true" tabindex="-1"></a>      <span class="at">shape =</span> shapes[<span class="fu">names</span>(palette)],</span>
<span id="cb13-202"><a href="#cb13-202" aria-hidden="true" tabindex="-1"></a>      <span class="at">color =</span> palette[<span class="fu">names</span>(palette)]</span>
<span id="cb13-203"><a href="#cb13-203" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb13-204"><a href="#cb13-204" aria-hidden="true" tabindex="-1"></a>    <span class="at">useGroups =</span> <span class="cn">FALSE</span>,</span>
<span id="cb13-205"><a href="#cb13-205" aria-hidden="true" tabindex="-1"></a>    <span class="at">position =</span> <span class="st">"right"</span></span>
<span id="cb13-206"><a href="#cb13-206" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb13-207"><a href="#cb13-207" aria-hidden="true" tabindex="-1"></a>  <span class="fu">visLayout</span>(<span class="at">randomSeed =</span> <span class="dv">42</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="htmlwidget-6498ad41c11ab6a497d8" style="width:100%;height:800px;" class="visNetwork html-widget"></div>
<script type="application/json" data-for="htmlwidget-6498ad41c11ab6a497d8">{"x":{"nodes":{"id":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136],"label":["Sam","Nadia Conti","Elise","Liam Thorne","Samantha Blake","Davis","Rodriguez","Clepper Jensen","Miranda Jordan","The Intern","The Lookout","The Accountant","Mrs. Money","The Middleman","Boss","Small Fry","Glitters Team","Oceanus City Council","Green Guardians","V. Miesel Shipping","Sailor Shifts Team","Neptune","Marlin","Serenity","Mako","Reef Guardian","Horizon","Seawatch","EcoVigil","Sentinel","Osprey","Defender","Northern Light","Remora","Knowles","Mariner's Dream","Recreational Fishing Boats","City Officials","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Suspicious","Suspicious","Suspicious","Suspicious","Suspicious","Suspicious","Suspicious","Suspicious","Suspicious","Suspicious","Suspicious","Suspicious","Suspicious","Suspicious","Suspicious","Suspicious","Unfriendly","Unfriendly"],"group":["Person","Person","Person","Person","Person","Person","Person","Person","Person","Person","Person","Person","Person","Person","Person","Person","Organization","Organization","Organization","Organization","Organization","Vessel","Vessel","Vessel","Vessel","Vessel","Vessel","Vessel","Vessel","Vessel","Vessel","Vessel","Vessel","Vessel","Vessel","Vessel","Group","Group","Relationship","Relationship","Relationship","Relationship","Relationship","Relationship","Relationship","Relationship","Relationship","Relationship","Relationship","Relationship","Relationship","Relationship","Relationship","Relationship","Relationship","Relationship","Relationship","Relationship","Relationship","Relationship","Relationship","Relationship","Relationship","Relationship","Relationship","Relationship","Relationship","Relationship","Relationship","Relationship","Relationship","Relationship","Relationship","Relationship","Relationship","Relationship","Relationship","Relationship","Relationship","Relationship","Relationship","Relationship","Relationship","Relationship","Relationship","Relationship","Relationship","Relationship","Relationship","Relationship","Relationship","Relationship","Relationship","Relationship","Relationship","Relationship","Relationship","Relationship","Relationship","Relationship","Relationship","Relationship","Relationship","Relationship","Relationship","Relationship","Relationship","Relationship","Relationship","Relationship","Relationship","Relationship","Relationship","Relationship","Relationship","Relationship","Relationship","Relationship","Relationship","Relationship","Relationship","Relationship","Relationship","Relationship","Relationship","Relationship","Relationship","Relationship","Relationship","Relationship","Relationship","Relationship","Relationship","Relationship","Relationship","Relationship"],"shape":["dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","diamond","diamond","diamond","diamond","diamond","triangle","triangle","triangle","triangle","triangle","triangle","triangle","triangle","triangle","triangle","triangle","triangle","triangle","triangle","triangle","star","star","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box"],"color":["orange","orange","orange","orange","orange","orange","orange","orange","orange","orange","orange","orange","orange","orange","orange","orange","red","red","red","red","red","forestgreen","forestgreen","forestgreen","forestgreen","forestgreen","forestgreen","forestgreen","forestgreen","forestgreen","forestgreen","forestgreen","forestgreen","forestgreen","forestgreen","forestgreen","orchid","orchid","skyblue","skyblue","skyblue","skyblue","skyblue","skyblue","skyblue","skyblue","skyblue","skyblue","skyblue","skyblue","skyblue","skyblue","skyblue","skyblue","skyblue","skyblue","skyblue","skyblue","skyblue","skyblue","skyblue","skyblue","skyblue","skyblue","skyblue","skyblue","skyblue","skyblue","skyblue","skyblue","skyblue","skyblue","skyblue","skyblue","skyblue","skyblue","skyblue","skyblue","skyblue","skyblue","skyblue","skyblue","skyblue","skyblue","skyblue","skyblue","skyblue","skyblue","skyblue","skyblue","skyblue","skyblue","skyblue","skyblue","skyblue","skyblue","skyblue","skyblue","skyblue","skyblue","skyblue","skyblue","skyblue","skyblue","skyblue","skyblue","skyblue","skyblue","skyblue","skyblue","skyblue","skyblue","skyblue","skyblue","skyblue","skyblue","skyblue","skyblue","skyblue","skyblue","skyblue","skyblue","skyblue","skyblue","skyblue","skyblue","skyblue","skyblue","skyblue","skyblue","skyblue","skyblue","skyblue","skyblue","skyblue","skyblue"],"title":[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,"AccessPermission","AccessPermission","AccessPermission","AccessPermission","Reports","Reports","Reports","Reports","Reports","Reports","Reports","Reports","Reports","Reports","Reports","Coordinates","Coordinates","Coordinates","Coordinates","Coordinates","Coordinates","Coordinates","Coordinates","Coordinates","Coordinates","Coordinates","Coordinates","Coordinates","Coordinates","Coordinates","Coordinates","Coordinates","Coordinates","Coordinates","Coordinates","Coordinates","Coordinates","Coordinates","Coordinates","Coordinates","Coordinates","Coordinates","Coordinates","Coordinates","Coordinates","Coordinates","Coordinates","Coordinates","Coordinates","Coordinates","Coordinates","Coordinates","Coordinates","Coordinates","Coordinates","Coordinates","Coordinates","Coordinates","Coordinates","Operates","Operates","Operates","Operates","Operates","Operates","Operates","Operates","Operates","Operates","Operates","Operates","Operates","Operates","Operates","Operates","Operates","Operates","Operates","Operates","Operates","Suspicious","Suspicious","Suspicious","Suspicious","Suspicious","Suspicious","Suspicious","Suspicious","Suspicious","Suspicious","Suspicious","Suspicious","Suspicious","Suspicious","Suspicious","Suspicious","Unfriendly","Unfriendly"]},"edges":{"from":[8,133,8,126,8,47,8,120,8,119,8,122,8,121,9,132,9,48,9,46,9,44,9,45,10,41,11,49,12,91,13,105,13,108,14,51,14,82,15,67,15,124,15,104,15,53,15,118,16,62,16,52,16,96,17,117,1,125,18,65,18,106,18,109,18,43,18,64,18,55,18,84,18,50,18,63,18,54,18,136,19,112,19,94,19,59,19,87,19,60,19,58,19,135,19,131,19,71,20,85,20,107,20,89,20,86,20,103,20,129,20,130,21,99,21,74,21,102,21,56,21,100,22,68,22,73,22,128,22,127,22,75,22,113,22,116,22,115,23,76,23,110,24,69,25,93,25,70,25,90,25,40,25,97,25,66,25,98,25,101,26,78,26,77,26,42,26,72,26,79,27,92,27,61,27,57,29,95,29,83,30,80,32,134,34,39,34,114,35,123,2,88,2,81,6,111],"to":[133,9,126,11,47,18,120,20,119,21,122,35,121,7,132,18,48,19,46,20,44,21,45,7,41,13,49,19,91,20,105,20,108,25,51,15,82,30,67,17,124,18,104,20,53,25,118,34,62,17,52,20,96,34,117,34,125,18,65,19,106,20,109,22,43,23,64,25,55,26,84,29,50,30,63,36,54,4,136,5,112,22,94,26,59,27,87,28,60,29,58,30,135,33,131,34,71,38,85,22,107,24,89,25,86,34,103,35,129,3,130,4,99,25,74,34,102,37,56,5,100,6,68,24,73,25,128,26,127,30,75,34,113,5,116,6,115,7,76,26,110,6,69,25,93,26,70,30,90,31,40,34,97,35,66,5,98,6,101,7,78,27,77,28,42,29,72,30,79,32,92,28,61,29,57,30,95,30,83,4,80,4,134,6,39,6,114,7,123,7,88,29,81,3,111,7],"arrows":["to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to"],"color":["grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey"]},"nodesToDataframe":true,"edgesToDataframe":true,"options":{"width":"100%","height":"100%","nodes":{"shape":"dot","font":{"size":18}},"manipulation":{"enabled":false},"edges":{"smooth":false},"interaction":{"hover":true,"zoomSpeed":1},"layout":{"randomSeed":42}},"groups":["Person","Organization","Vessel","Group","Relationship"],"width":"100%","height":"800px","idselection":{"enabled":true,"style":"width: 150px; height: 26px","useLabels":true,"main":"Select by id","values":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38]},"byselection":{"enabled":false,"style":"width: 150px; height: 26px","multiple":false,"hideColor":"rgba(200,200,200,0.5)","highlight":false},"main":null,"submain":null,"footer":null,"background":"rgba(0, 0, 0, 0)","tooltipStay":300,"tooltipStyle":"position: fixed;visibility:hidden;padding: 5px;white-space: nowrap;font-family: verdana;font-size:14px;font-color:#000000;background-color: #f5f4ed;-moz-border-radius: 3px;-webkit-border-radius: 3px;border-radius: 3px;border: 1px solid #808074;box-shadow: 3px 3px 10px rgba(0, 0, 0, 0.2);","highlight":{"enabled":true,"hoverNearest":true,"degree":2,"algorithm":"all","hideColor":"rgba(200,200,200,0.5)","labelOnly":true},"collapse":{"enabled":false,"fit":false,"resetHighlight":true,"clusterOptions":null,"keepCoord":true,"labelSuffix":"(cluster)"},"legend":{"width":0.2,"useGroups":false,"position":"right","ncol":1,"stepX":100,"stepY":100,"zoom":true,"nodes":{"label":["Person","Organization","Vessel","Group","Relationship"],"shape":["dot","diamond","triangle","star","box"],"color":["orange","red","forestgreen","orchid","skyblue"]},"nodesToDataframe":true}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(visNetwork)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(RColorBrewer)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Choose clustering method</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>clustering_method <span class="ot">&lt;-</span> <span class="st">"louvain"</span>  <span class="co"># options: "louvain" or "label_prop"</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Make sure IDs are character</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>vis_nodes <span class="ot">&lt;-</span> vis_nodes <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">id =</span> <span class="fu">as.character</span>(id))</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>vis_edges <span class="ot">&lt;-</span> vis_edges <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">from =</span> <span class="fu">as.character</span>(from), <span class="at">to =</span> <span class="fu">as.character</span>(to))</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Build igraph object</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>g <span class="ot">&lt;-</span> <span class="fu">graph_from_data_frame</span>(<span class="at">d =</span> vis_edges, <span class="at">vertices =</span> vis_nodes, <span class="at">directed =</span> <span class="cn">TRUE</span>)</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>g_undirected <span class="ot">&lt;-</span> <span class="fu">as.undirected</span>(g, <span class="at">mode =</span> <span class="st">"collapse"</span>)</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply clustering</span></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>clusters <span class="ot">&lt;-</span> <span class="cf">switch</span>(</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>  clustering_method,</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">louvain     =</span> <span class="fu">cluster_louvain</span>(g_undirected),</span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">label_prop  =</span> <span class="fu">cluster_label_prop</span>(g_undirected),</span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stop</span>(<span class="st">"Unsupported clustering method"</span>)</span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Cluster membership (ensure id matches vis_nodes$id)</span></span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>membership_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">id =</span> <span class="fu">names</span>(<span class="fu">membership</span>(clusters)),</span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">cluster_id =</span> <span class="fu">membership</span>(clusters),</span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span></span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Join and add color/group</span></span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a>n_clusters <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">unique</span>(membership_df<span class="sc">$</span>cluster_id))</span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a>color_palette <span class="ot">&lt;-</span> RColorBrewer<span class="sc">::</span><span class="fu">brewer.pal</span>(<span class="fu">max</span>(<span class="dv">3</span>, <span class="fu">min</span>(<span class="dv">8</span>, n_clusters)), <span class="st">"Set2"</span>)</span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a>vis_nodes_clustered <span class="ot">&lt;-</span> vis_nodes <span class="sc">%&gt;%</span></span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(membership_df, <span class="at">by =</span> <span class="st">"id"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb14-37"><a href="#cb14-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb14-38"><a href="#cb14-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">group =</span> <span class="fu">paste0</span>(<span class="st">"Cluster "</span>, cluster_id),</span>
<span id="cb14-39"><a href="#cb14-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> color_palette[<span class="fu">as.numeric</span>(<span class="fu">factor</span>(cluster_id))],</span>
<span id="cb14-40"><a href="#cb14-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">shape =</span> shape  <span class="co"># preserve original shape if present</span></span>
<span id="cb14-41"><a href="#cb14-41" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb14-42"><a href="#cb14-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-43"><a href="#cb14-43" aria-hidden="true" tabindex="-1"></a><span class="co"># Draw graph</span></span>
<span id="cb14-44"><a href="#cb14-44" aria-hidden="true" tabindex="-1"></a><span class="fu">visNetwork</span>(vis_nodes_clustered, vis_edges, <span class="at">width =</span> <span class="st">"100%"</span>, <span class="at">height =</span> <span class="st">"800px"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb14-45"><a href="#cb14-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">visNodes</span>(<span class="at">font =</span> <span class="fu">list</span>(<span class="at">size =</span> <span class="dv">18</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb14-46"><a href="#cb14-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">visEdges</span>(<span class="at">smooth =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb14-47"><a href="#cb14-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">visOptions</span>(</span>
<span id="cb14-48"><a href="#cb14-48" aria-hidden="true" tabindex="-1"></a>    <span class="at">highlightNearest =</span> <span class="fu">list</span>(<span class="at">enabled =</span> <span class="cn">TRUE</span>, <span class="at">degree =</span> <span class="dv">2</span>, <span class="at">hover =</span> <span class="cn">TRUE</span>),</span>
<span id="cb14-49"><a href="#cb14-49" aria-hidden="true" tabindex="-1"></a>    <span class="at">nodesIdSelection =</span> <span class="cn">TRUE</span></span>
<span id="cb14-50"><a href="#cb14-50" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb14-51"><a href="#cb14-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">visLegend</span>(<span class="at">useGroups =</span> <span class="cn">TRUE</span>, <span class="at">position =</span> <span class="st">"right"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb14-52"><a href="#cb14-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">visLayout</span>(<span class="at">randomSeed =</span> <span class="dv">42</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="htmlwidget-30678e41b64683288482" style="width:100%;height:800px;" class="visNetwork html-widget"></div>
<script type="application/json" data-for="htmlwidget-30678e41b64683288482">{"x":{"nodes":{"id":["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100","101","102","103","104","105","106","107","108","109","110","111","112","113","114","115","116","117","118","119","120","121","122","123","124","125","126","127","128","129","130","131","132","133","134","135","136"],"label":["Sam","Nadia Conti","Elise","Liam Thorne","Samantha Blake","Davis","Rodriguez","Clepper Jensen","Miranda Jordan","The Intern","The Lookout","The Accountant","Mrs. Money","The Middleman","Boss","Small Fry","Glitters Team","Oceanus City Council","Green Guardians","V. Miesel Shipping","Sailor Shifts Team","Neptune","Marlin","Serenity","Mako","Reef Guardian","Horizon","Seawatch","EcoVigil","Sentinel","Osprey","Defender","Northern Light","Remora","Knowles","Mariner's Dream","Recreational Fishing Boats","City Officials","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Operational","Suspicious","Suspicious","Suspicious","Suspicious","Suspicious","Suspicious","Suspicious","Suspicious","Suspicious","Suspicious","Suspicious","Suspicious","Suspicious","Suspicious","Suspicious","Suspicious","Unfriendly","Unfriendly"],"group":["Cluster 1","Cluster 2","Cluster 2","Cluster 1","Cluster 3","Cluster 4","Cluster 5","Cluster 5","Cluster 5","Cluster 2","Cluster 6","Cluster 2","Cluster 2","Cluster 1","Cluster 7","Cluster 7","Cluster 7","Cluster 1","Cluster 6","Cluster 2","Cluster 3","Cluster 8","Cluster 4","Cluster 8","Cluster 8","Cluster 6","Cluster 6","Cluster 6","Cluster 1","Cluster 1","Cluster 8","Cluster 4","Cluster 6","Cluster 7","Cluster 5","Cluster 1","Cluster 3","Cluster 6","Cluster 4","Cluster 7","Cluster 2","Cluster 1","Cluster 4","Cluster 3","Cluster 5","Cluster 5","Cluster 5","Cluster 5","Cluster 6","Cluster 1","Cluster 1","Cluster 7","Cluster 7","Cluster 1","Cluster 6","Cluster 3","Cluster 6","Cluster 1","Cluster 6","Cluster 1","Cluster 6","Cluster 7","Cluster 1","Cluster 8","Cluster 6","Cluster 3","Cluster 7","Cluster 8","Cluster 8","Cluster 1","Cluster 6","Cluster 1","Cluster 8","Cluster 3","Cluster 7","Cluster 4","Cluster 6","Cluster 6","Cluster 4","Cluster 1","Cluster 2","Cluster 1","Cluster 1","Cluster 1","Cluster 8","Cluster 7","Cluster 6","Cluster 2","Cluster 2","Cluster 8","Cluster 2","Cluster 6","Cluster 6","Cluster 6","Cluster 1","Cluster 7","Cluster 5","Cluster 4","Cluster 3","Cluster 3","Cluster 5","Cluster 3","Cluster 5","Cluster 7","Cluster 2","Cluster 2","Cluster 8","Cluster 2","Cluster 8","Cluster 4","Cluster 4","Cluster 8","Cluster 3","Cluster 5","Cluster 5","Cluster 4","Cluster 7","Cluster 7","Cluster 5","Cluster 5","Cluster 5","Cluster 5","Cluster 5","Cluster 7","Cluster 1","Cluster 6","Cluster 1","Cluster 6","Cluster 2","Cluster 1","Cluster 6","Cluster 5","Cluster 5","Cluster 4","Cluster 6","Cluster 3"],"shape":["dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","diamond","diamond","diamond","diamond","diamond","triangle","triangle","triangle","triangle","triangle","triangle","triangle","triangle","triangle","triangle","triangle","triangle","triangle","triangle","triangle","star","star","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box","box"],"color":["#66C2A5","#FC8D62","#FC8D62","#66C2A5","#8DA0CB","#E78AC3","#A6D854","#A6D854","#A6D854","#FC8D62","#FFD92F","#FC8D62","#FC8D62","#66C2A5","#E5C494","#E5C494","#E5C494","#66C2A5","#FFD92F","#FC8D62","#8DA0CB","#B3B3B3","#E78AC3","#B3B3B3","#B3B3B3","#FFD92F","#FFD92F","#FFD92F","#66C2A5","#66C2A5","#B3B3B3","#E78AC3","#FFD92F","#E5C494","#A6D854","#66C2A5","#8DA0CB","#FFD92F","#E78AC3","#E5C494","#FC8D62","#66C2A5","#E78AC3","#8DA0CB","#A6D854","#A6D854","#A6D854","#A6D854","#FFD92F","#66C2A5","#66C2A5","#E5C494","#E5C494","#66C2A5","#FFD92F","#8DA0CB","#FFD92F","#66C2A5","#FFD92F","#66C2A5","#FFD92F","#E5C494","#66C2A5","#B3B3B3","#FFD92F","#8DA0CB","#E5C494","#B3B3B3","#B3B3B3","#66C2A5","#FFD92F","#66C2A5","#B3B3B3","#8DA0CB","#E5C494","#E78AC3","#FFD92F","#FFD92F","#E78AC3","#66C2A5","#FC8D62","#66C2A5","#66C2A5","#66C2A5","#B3B3B3","#E5C494","#FFD92F","#FC8D62","#FC8D62","#B3B3B3","#FC8D62","#FFD92F","#FFD92F","#FFD92F","#66C2A5","#E5C494","#A6D854","#E78AC3","#8DA0CB","#8DA0CB","#A6D854","#8DA0CB","#A6D854","#E5C494","#FC8D62","#FC8D62","#B3B3B3","#FC8D62","#B3B3B3","#E78AC3","#E78AC3","#B3B3B3","#8DA0CB","#A6D854","#A6D854","#E78AC3","#E5C494","#E5C494","#A6D854","#A6D854","#A6D854","#A6D854","#A6D854","#E5C494","#66C2A5","#FFD92F","#66C2A5","#FFD92F","#FC8D62","#66C2A5","#FFD92F","#A6D854","#A6D854","#E78AC3","#FFD92F","#8DA0CB"],"title":[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,"AccessPermission","AccessPermission","AccessPermission","AccessPermission","Reports","Reports","Reports","Reports","Reports","Reports","Reports","Reports","Reports","Reports","Reports","Coordinates","Coordinates","Coordinates","Coordinates","Coordinates","Coordinates","Coordinates","Coordinates","Coordinates","Coordinates","Coordinates","Coordinates","Coordinates","Coordinates","Coordinates","Coordinates","Coordinates","Coordinates","Coordinates","Coordinates","Coordinates","Coordinates","Coordinates","Coordinates","Coordinates","Coordinates","Coordinates","Coordinates","Coordinates","Coordinates","Coordinates","Coordinates","Coordinates","Coordinates","Coordinates","Coordinates","Coordinates","Coordinates","Coordinates","Coordinates","Coordinates","Coordinates","Coordinates","Coordinates","Operates","Operates","Operates","Operates","Operates","Operates","Operates","Operates","Operates","Operates","Operates","Operates","Operates","Operates","Operates","Operates","Operates","Operates","Operates","Operates","Operates","Suspicious","Suspicious","Suspicious","Suspicious","Suspicious","Suspicious","Suspicious","Suspicious","Suspicious","Suspicious","Suspicious","Suspicious","Suspicious","Suspicious","Suspicious","Suspicious","Unfriendly","Unfriendly"],"cluster_id":[1,2,2,1,3,4,5,5,5,2,6,2,2,1,7,7,7,1,6,2,3,8,4,8,8,6,6,6,1,1,8,4,6,7,5,1,3,6,4,7,2,1,4,3,5,5,5,5,6,1,1,7,7,1,6,3,6,1,6,1,6,7,1,8,6,3,7,8,8,1,6,1,8,3,7,4,6,6,4,1,2,1,1,1,8,7,6,2,2,8,2,6,6,6,1,7,5,4,3,3,5,3,5,7,2,2,8,2,8,4,4,8,3,5,5,4,7,7,5,5,5,5,5,7,1,6,1,6,2,1,6,5,5,4,6,3]},"edges":{"from":["8","133","8","126","8","47","8","120","8","119","8","122","8","121","9","132","9","48","9","46","9","44","9","45","10","41","11","49","12","91","13","105","13","108","14","51","14","82","15","67","15","124","15","104","15","53","15","118","16","62","16","52","16","96","17","117","1","125","18","65","18","106","18","109","18","43","18","64","18","55","18","84","18","50","18","63","18","54","18","136","19","112","19","94","19","59","19","87","19","60","19","58","19","135","19","131","19","71","20","85","20","107","20","89","20","86","20","103","20","129","20","130","21","99","21","74","21","102","21","56","21","100","22","68","22","73","22","128","22","127","22","75","22","113","22","116","22","115","23","76","23","110","24","69","25","93","25","70","25","90","25","40","25","97","25","66","25","98","25","101","26","78","26","77","26","42","26","72","26","79","27","92","27","61","27","57","29","95","29","83","30","80","32","134","34","39","34","114","35","123","2","88","2","81","6","111"],"to":["133","9","126","11","47","18","120","20","119","21","122","35","121","7","132","18","48","19","46","20","44","21","45","7","41","13","49","19","91","20","105","20","108","25","51","15","82","30","67","17","124","18","104","20","53","25","118","34","62","17","52","20","96","34","117","34","125","18","65","19","106","20","109","22","43","23","64","25","55","26","84","29","50","30","63","36","54","4","136","5","112","22","94","26","59","27","87","28","60","29","58","30","135","33","131","34","71","38","85","22","107","24","89","25","86","34","103","35","129","3","130","4","99","25","74","34","102","37","56","5","100","6","68","24","73","25","128","26","127","30","75","34","113","5","116","6","115","7","76","26","110","6","69","25","93","26","70","30","90","31","40","34","97","35","66","5","98","6","101","7","78","27","77","28","42","29","72","30","79","32","92","28","61","29","57","30","95","30","83","4","80","4","134","6","39","6","114","7","123","7","88","29","81","3","111","7"],"arrows":["to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to","to"],"color":["grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey","grey"]},"nodesToDataframe":true,"edgesToDataframe":true,"options":{"width":"100%","height":"100%","nodes":{"shape":"dot","font":{"size":18}},"manipulation":{"enabled":false},"edges":{"smooth":false},"interaction":{"hover":true,"zoomSpeed":1},"layout":{"randomSeed":42}},"groups":["Cluster 1","Cluster 2","Cluster 3","Cluster 4","Cluster 5","Cluster 6","Cluster 7","Cluster 8"],"width":"100%","height":"800px","idselection":{"enabled":true,"style":"width: 150px; height: 26px","useLabels":true,"main":"Select by id"},"byselection":{"enabled":false,"style":"width: 150px; height: 26px","multiple":false,"hideColor":"rgba(200,200,200,0.5)","highlight":false},"main":null,"submain":null,"footer":null,"background":"rgba(0, 0, 0, 0)","tooltipStay":300,"tooltipStyle":"position: fixed;visibility:hidden;padding: 5px;white-space: nowrap;font-family: verdana;font-size:14px;font-color:#000000;background-color: #f5f4ed;-moz-border-radius: 3px;-webkit-border-radius: 3px;border-radius: 3px;border: 1px solid #808074;box-shadow: 3px 3px 10px rgba(0, 0, 0, 0.2);","highlight":{"enabled":true,"hoverNearest":true,"degree":2,"algorithm":"all","hideColor":"rgba(200,200,200,0.5)","labelOnly":true},"collapse":{"enabled":false,"fit":false,"resetHighlight":true,"clusterOptions":null,"keepCoord":true,"labelSuffix":"(cluster)"},"legend":{"width":0.2,"useGroups":true,"position":"right","ncol":1,"stepX":100,"stepY":100,"zoom":true}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">V</span>(g_undirected)<span class="sc">$</span>name <span class="ot">&lt;-</span> vis_nodes<span class="sc">$</span>id</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute centrality measures</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>centrality_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">id =</span> <span class="fu">V</span>(g_undirected)<span class="sc">$</span>name,</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">degree =</span> <span class="fu">degree</span>(g_undirected),</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">betweenness =</span> <span class="fu">betweenness</span>(g_undirected, <span class="at">normalized =</span> <span class="cn">TRUE</span>),</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">closeness =</span> <span class="fu">closeness</span>(g_undirected, <span class="at">normalized =</span> <span class="cn">TRUE</span>),</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">eigenvector =</span> <span class="fu">eigen_centrality</span>(g_undirected)<span class="sc">$</span>vector,</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge with vis_nodes to get name and sub-type</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>vis_nodes_clean <span class="ot">&lt;-</span> nodes_tbl <span class="sc">%&gt;%</span> </span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="at">id =</span> row_id, label, <span class="at">sub_type =</span> vis_type)</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>centrality_df <span class="ot">&lt;-</span> centrality_df <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">id =</span> <span class="fu">as.character</span>(id))</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>vis_nodes_clean <span class="ot">&lt;-</span> vis_nodes_clean <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">id =</span> <span class="fu">as.character</span>(id))</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>membership_df <span class="ot">&lt;-</span> membership_df <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">id =</span> <span class="fu">as.character</span>(id))</span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>centrality_table <span class="ot">&lt;-</span> centrality_df <span class="sc">%&gt;%</span></span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(vis_nodes_clean <span class="sc">%&gt;%</span> <span class="fu">select</span>(id, <span class="at">Name =</span> label, <span class="st">`</span><span class="at">Sub-type</span><span class="st">`</span> <span class="ot">=</span> sub_type), <span class="at">by =</span> <span class="st">"id"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(membership_df, <span class="at">by =</span> <span class="st">"id"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Name, <span class="st">`</span><span class="at">Sub-type</span><span class="st">`</span>, <span class="at">Cluster =</span> cluster_id,</span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">Degree centrality</span><span class="st">`</span> <span class="ot">=</span> degree,</span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">Betweenness centrality</span><span class="st">`</span> <span class="ot">=</span> betweenness,</span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">Closeness centrality</span><span class="st">`</span> <span class="ot">=</span> closeness,</span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">Eigenvector centrality</span><span class="st">`</span> <span class="ot">=</span> eigenvector) <span class="sc">%&gt;%</span></span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), <span class="sc">~</span> <span class="fu">round</span>(.x, <span class="dv">2</span>)))</span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a><span class="co"># round numeric metrics</span></span>
<span id="cb15-34"><a href="#cb15-34" aria-hidden="true" tabindex="-1"></a>centrality_table <span class="ot">&lt;-</span> centrality_table <span class="sc">%&gt;%</span></span>
<span id="cb15-35"><a href="#cb15-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), <span class="sc">~</span> <span class="fu">round</span>(.x, <span class="dv">2</span>)))</span>
<span id="cb15-36"><a href="#cb15-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-37"><a href="#cb15-37" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(centrality_table)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                          Name     Sub-type Cluster Degree centrality
1                          Sam       Person       1                 1
2                  Nadia Conti       Person       2                 2
3                        Elise       Person       2                 2
4                  Liam Thorne       Person       1                 4
5               Samantha Blake       Person       3                 4
6                        Davis       Person       4                 7
7                    Rodriguez       Person       5                 7
8               Clepper Jensen       Person       5                 7
9               Miranda Jordan       Person       5                 6
10                  The Intern       Person       2                 1
11                 The Lookout       Person       6                 2
12              The Accountant       Person       2                 1
13                  Mrs. Money       Person       2                 3
14               The Middleman       Person       1                 2
15                        Boss       Person       7                 6
16                   Small Fry       Person       7                 3
17               Glitters Team Organization       7                 3
18        Oceanus City Council Organization       1                15
19             Green Guardians Organization       6                12
20          V. Miesel Shipping Organization       2                14
21          Sailor Shifts Team Organization       3                 7
22                     Neptune       Vessel       8                11
23                      Marlin       Vessel       4                 3
24                    Serenity       Vessel       8                 3
25                        Mako       Vessel       8                15
26               Reef Guardian       Vessel       6                10
27                     Horizon       Vessel       6                 5
28                    Seawatch       Vessel       6                 3
29                    EcoVigil       Vessel       1                 7
30                    Sentinel       Vessel       1                 9
31                      Osprey       Vessel       8                 1
32                    Defender       Vessel       4                 2
33              Northern Light       Vessel       6                 1
34                      Remora       Vessel       7                10
35                     Knowles       Vessel       5                 4
36             Mariner's Dream       Vessel       1                 1
37  Recreational Fishing Boats        Group       3                 1
38              City Officials        Group       6                 1
39                 Operational Relationship       4                 2
40                 Operational Relationship       7                 2
41                 Operational Relationship       2                 2
42                 Operational Relationship       1                 2
43                 Operational Relationship       4                 2
44                 Operational Relationship       3                 2
45                 Operational Relationship       5                 2
46                 Operational Relationship       5                 2
47                 Operational Relationship       5                 2
48                 Operational Relationship       5                 2
49                 Operational Relationship       6                 2
50                 Operational Relationship       1                 2
51                 Operational Relationship       1                 2
52                 Operational Relationship       7                 2
53                 Operational Relationship       7                 2
54                 Operational Relationship       1                 2
55                 Operational Relationship       6                 2
56                 Operational Relationship       3                 2
57                 Operational Relationship       6                 2
58                 Operational Relationship       1                 2
59                 Operational Relationship       6                 2
60                 Operational Relationship       1                 2
61                 Operational Relationship       6                 2
62                 Operational Relationship       7                 2
63                 Operational Relationship       1                 2
64                 Operational Relationship       8                 2
65                 Operational Relationship       6                 2
66                 Operational Relationship       3                 2
67                 Operational Relationship       7                 2
68                 Operational Relationship       8                 2
69                 Operational Relationship       8                 2
70                 Operational Relationship       1                 2
71                 Operational Relationship       6                 2
72                 Operational Relationship       1                 2
73                 Operational Relationship       8                 2
74                 Operational Relationship       3                 2
75                 Operational Relationship       7                 2
76                 Operational Relationship       4                 2
77                 Operational Relationship       6                 2
78                 Operational Relationship       6                 2
79                 Operational Relationship       4                 2
80                 Operational Relationship       1                 2
81                 Operational Relationship       2                 2
82                 Operational Relationship       1                 2
83                 Operational Relationship       1                 2
84                 Operational Relationship       1                 2
85                 Operational Relationship       8                 2
86                 Operational Relationship       7                 2
87                 Operational Relationship       6                 2
88                 Operational Relationship       2                 2
89                 Operational Relationship       2                 2
90                 Operational Relationship       8                 2
91                 Operational Relationship       2                 2
92                 Operational Relationship       6                 2
93                 Operational Relationship       6                 2
94                 Operational Relationship       6                 2
95                 Operational Relationship       1                 2
96                 Operational Relationship       7                 2
97                 Operational Relationship       5                 2
98                 Operational Relationship       4                 2
99                 Operational Relationship       3                 2
100                Operational Relationship       3                 2
101                Operational Relationship       5                 2
102                Operational Relationship       3                 2
103                Operational Relationship       5                 2
104                Operational Relationship       7                 2
105                Operational Relationship       2                 2
106                Operational Relationship       2                 2
107                Operational Relationship       8                 2
108                Operational Relationship       2                 2
109                Operational Relationship       8                 2
110                Operational Relationship       4                 2
111                Operational Relationship       4                 2
112                Operational Relationship       8                 2
113                Operational Relationship       3                 2
114                Operational Relationship       5                 2
115                Operational Relationship       5                 2
116                Operational Relationship       4                 2
117                Operational Relationship       7                 2
118                Operational Relationship       7                 2
119                 Suspicious Relationship       5                 2
120                 Suspicious Relationship       5                 2
121                 Suspicious Relationship       5                 2
122                 Suspicious Relationship       5                 2
123                 Suspicious Relationship       5                 2
124                 Suspicious Relationship       7                 2
125                 Suspicious Relationship       1                 2
126                 Suspicious Relationship       6                 2
127                 Suspicious Relationship       1                 2
128                 Suspicious Relationship       6                 2
129                 Suspicious Relationship       2                 2
130                 Suspicious Relationship       1                 2
131                 Suspicious Relationship       6                 2
132                 Suspicious Relationship       5                 2
133                 Suspicious Relationship       5                 2
134                 Suspicious Relationship       4                 2
135                 Unfriendly Relationship       6                 2
136                 Unfriendly Relationship       3                 2
    Betweenness centrality Closeness centrality Eigenvector centrality
1                     0.00                 0.20                   0.05
2                     0.01                 0.18                   0.01
3                     0.01                 0.20                   0.04
4                     0.02                 0.24                   0.14
5                     0.02                 0.24                   0.17
6                     0.05                 0.24                   0.19
7                     0.05                 0.25                   0.21
8                     0.06                 0.25                   0.19
9                     0.05                 0.26                   0.20
10                    0.00                 0.15                   0.01
11                    0.01                 0.20                   0.03
12                    0.00                 0.19                   0.04
13                    0.03                 0.22                   0.10
14                    0.00                 0.20                   0.03
15                    0.05                 0.26                   0.23
16                    0.01                 0.21                   0.07
17                    0.01                 0.20                   0.04
18                    0.24                 0.33                   1.00
19                    0.18                 0.28                   0.42
20                    0.21                 0.30                   0.73
21                    0.06                 0.24                   0.17
22                    0.13                 0.31                   0.56
23                    0.01                 0.22                   0.09
24                    0.01                 0.23                   0.14
25                    0.23                 0.32                   1.00
26                    0.12                 0.28                   0.39
27                    0.02                 0.21                   0.10
28                    0.01                 0.20                   0.05
29                    0.06                 0.24                   0.19
30                    0.09                 0.28                   0.35
31                    0.00                 0.20                   0.05
32                    0.00                 0.20                   0.03
33                    0.00                 0.18                   0.02
34                    0.13                 0.29                   0.37
35                    0.02                 0.23                   0.13
36                    0.00                 0.20                   0.05
37                    0.00                 0.16                   0.01
38                    0.00                 0.18                   0.02
39                    0.01                 0.23                   0.13
40                    0.02                 0.27                   0.31
41                    0.01                 0.18                   0.02
42                    0.01                 0.23                   0.13
43                    0.01                 0.25                   0.25
44                    0.01                 0.23                   0.08
45                    0.01                 0.24                   0.09
46                    0.02                 0.25                   0.21
47                    0.03                 0.26                   0.27
48                    0.02                 0.25                   0.14
49                    0.01                 0.23                   0.10
50                    0.02                 0.26                   0.30
51                    0.01                 0.21                   0.06
52                    0.02                 0.23                   0.18
53                    0.02                 0.25                   0.28
54                    0.01                 0.25                   0.26
55                    0.02                 0.26                   0.31
56                    0.01                 0.21                   0.08
57                    0.01                 0.22                   0.10
58                    0.02                 0.24                   0.17
59                    0.01                 0.22                   0.12
60                    0.02                 0.23                   0.14
61                    0.00                 0.20                   0.06
62                    0.00                 0.18                   0.02
63                    0.01                 0.25                   0.24
64                    0.03                 0.28                   0.45
65                    0.03                 0.27                   0.32
66                    0.01                 0.25                   0.26
67                    0.01                 0.21                   0.06
68                    0.01                 0.24                   0.16
69                    0.01                 0.25                   0.26
70                    0.03                 0.27                   0.30
71                    0.01                 0.22                   0.10
72                    0.01                 0.23                   0.17
73                    0.01                 0.26                   0.35
74                    0.02                 0.24                   0.12
75                    0.01                 0.26                   0.21
76                    0.01                 0.22                   0.11
77                    0.01                 0.22                   0.10
78                    0.01                 0.22                   0.11
79                    0.01                 0.22                   0.09
80                    0.01                 0.23                   0.11
81                    0.01                 0.18                   0.01
82                    0.01                 0.22                   0.09
83                    0.01                 0.21                   0.07
84                    0.03                 0.26                   0.27
85                    0.03                 0.27                   0.29
86                    0.03                 0.26                   0.25
87                    0.01                 0.22                   0.11
88                    0.02                 0.20                   0.05
89                    0.03                 0.27                   0.39
90                    0.01                 0.24                   0.24
91                    0.01                 0.23                   0.17
92                    0.00                 0.18                   0.03
93                    0.04                 0.27                   0.31
94                    0.02                 0.24                   0.18
95                    0.01                 0.22                   0.12
96                    0.01                 0.23                   0.10
97                    0.01                 0.25                   0.26
98                    0.02                 0.25                   0.27
99                    0.03                 0.26                   0.26
100                   0.01                 0.21                   0.08
101                   0.01                 0.26                   0.27
102                   0.01                 0.20                   0.04
103                   0.01                 0.24                   0.19
104                   0.01                 0.24                   0.22
105                   0.02                 0.23                   0.19
106                   0.04                 0.28                   0.39
107                   0.01                 0.23                   0.19
108                   0.03                 0.25                   0.25
109                   0.02                 0.27                   0.35
110                   0.01                 0.22                   0.06
111                   0.01                 0.21                   0.09
112                   0.03                 0.26                   0.22
113                   0.01                 0.25                   0.17
114                   0.01                 0.24                   0.13
115                   0.01                 0.25                   0.17
116                   0.01                 0.25                   0.17
117                   0.01                 0.23                   0.09
118                   0.01                 0.24                   0.13
119                   0.01                 0.22                   0.08
120                   0.02                 0.24                   0.21
121                   0.01                 0.23                   0.09
122                   0.00                 0.21                   0.07
123                   0.00                 0.21                   0.08
124                   0.02                 0.26                   0.28
125                   0.01                 0.25                   0.24
126                   0.01                 0.21                   0.05
127                   0.02                 0.25                   0.21
128                   0.02                 0.26                   0.21
129                   0.03                 0.23                   0.17
130                   0.02                 0.24                   0.20
131                   0.05                 0.27                   0.18
132                   0.02                 0.26                   0.27
133                   0.00                 0.21                   0.09
134                   0.01                 0.21                   0.05
135                   0.01                 0.22                   0.10
136                   0.01                 0.25                   0.26</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Build Communication tables</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>valid_entity_types <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Person"</span>, <span class="st">"Organization"</span>, <span class="st">"Vessel"</span>, <span class="st">"Group"</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>node_lookup <span class="ot">&lt;-</span> mc3_nodes_final <span class="sc">%&gt;%</span> <span class="fu">select</span>(new_index, sub_type, name)</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>edges_labeled <span class="ot">&lt;-</span> mc3_edges_final <span class="sc">%&gt;%</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(node_lookup, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"from"</span> <span class="ot">=</span> <span class="st">"new_index"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">from_type =</span> sub_type, <span class="at">from_name =</span> name) <span class="sc">%&gt;%</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(node_lookup, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"to"</span> <span class="ot">=</span> <span class="st">"new_index"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">to_type =</span> sub_type, <span class="at">to_name =</span> name)</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>entity_comm <span class="ot">&lt;-</span> edges_labeled <span class="sc">%&gt;%</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>    (from_type <span class="sc">%in%</span> valid_entity_types <span class="sc">&amp;</span> to_type <span class="sc">==</span> <span class="st">"Communication"</span>) <span class="sc">|</span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>    (to_type <span class="sc">%in%</span> valid_entity_types <span class="sc">&amp;</span> from_type <span class="sc">==</span> <span class="st">"Communication"</span>)</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">entity =</span> <span class="fu">if_else</span>(from_type <span class="sc">%in%</span> valid_entity_types, from_name, to_name),</span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">comm   =</span> <span class="fu">if_else</span>(from_type <span class="sc">%in%</span> valid_entity_types, to, from),</span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">type   =</span> <span class="fu">if_else</span>(from_type <span class="sc">%in%</span> valid_entity_types, from_type, to_type)</span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Pairwise co-occurrences</span></span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>edges_raw <span class="ot">&lt;-</span> entity_comm <span class="sc">%&gt;%</span></span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(entity_comm, <span class="at">by =</span> <span class="st">"comm"</span>, <span class="at">suffix =</span> <span class="fu">c</span>(<span class="st">"_a"</span>, <span class="st">"_b"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(entity_a <span class="sc">!=</span> entity_b) <span class="sc">%&gt;%</span></span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pair_id =</span> <span class="fu">map2_chr</span>(entity_a, entity_b, <span class="sc">~</span> <span class="fu">paste</span>(<span class="fu">sort</span>(<span class="fu">c</span>(.x, .y)), <span class="at">collapse =</span> <span class="st">"||"</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(pair_id, entity_a, entity_b, <span class="at">name =</span> <span class="st">"weight"</span>)</span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Node table</span></span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a>nodes_tbl <span class="ot">&lt;-</span> entity_comm <span class="sc">%&gt;%</span></span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(<span class="at">name =</span> entity, <span class="at">sub_type =</span> type) <span class="sc">%&gt;%</span></span>
<span id="cb17-32"><a href="#cb17-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">row_id =</span> <span class="fu">row_number</span>())</span>
<span id="cb17-33"><a href="#cb17-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-34"><a href="#cb17-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Edge table</span></span>
<span id="cb17-35"><a href="#cb17-35" aria-hidden="true" tabindex="-1"></a>id_lkp <span class="ot">&lt;-</span> nodes_tbl <span class="sc">%&gt;%</span> <span class="fu">select</span>(name, row_id)</span>
<span id="cb17-36"><a href="#cb17-36" aria-hidden="true" tabindex="-1"></a>edges_final <span class="ot">&lt;-</span> edges_raw <span class="sc">%&gt;%</span></span>
<span id="cb17-37"><a href="#cb17-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(id_lkp, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"entity_a"</span> <span class="ot">=</span> <span class="st">"name"</span>)) <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">from =</span> row_id) <span class="sc">%&gt;%</span></span>
<span id="cb17-38"><a href="#cb17-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(id_lkp, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"entity_b"</span> <span class="ot">=</span> <span class="st">"name"</span>)) <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">to =</span> row_id) <span class="sc">%&gt;%</span></span>
<span id="cb17-39"><a href="#cb17-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(from, to, weight)</span>
<span id="cb17-40"><a href="#cb17-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-41"><a href="#cb17-41" aria-hidden="true" tabindex="-1"></a>full_graph <span class="ot">&lt;-</span> <span class="fu">tbl_graph</span>(<span class="at">nodes =</span> nodes_tbl, <span class="at">edges =</span> edges_final, <span class="at">directed =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb17-42"><a href="#cb17-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb17-43"><a href="#cb17-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">degree      =</span> <span class="fu">centrality_degree</span>(),</span>
<span id="cb17-44"><a href="#cb17-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">betweenness =</span> <span class="fu">centrality_betweenness</span>(),</span>
<span id="cb17-45"><a href="#cb17-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">closeness   =</span> <span class="fu">centrality_closeness</span>(),</span>
<span id="cb17-46"><a href="#cb17-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">eigen       =</span> <span class="fu">centrality_eigen</span>()</span>
<span id="cb17-47"><a href="#cb17-47" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb17-48"><a href="#cb17-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-49"><a href="#cb17-49" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize</span></span>
<span id="cb17-50"><a href="#cb17-50" aria-hidden="true" tabindex="-1"></a>vis_nodes <span class="ot">&lt;-</span> full_graph <span class="sc">%&gt;%</span></span>
<span id="cb17-51"><a href="#cb17-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb17-52"><a href="#cb17-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb17-53"><a href="#cb17-53" aria-hidden="true" tabindex="-1"></a>    <span class="at">id =</span> <span class="fu">row_number</span>(),</span>
<span id="cb17-54"><a href="#cb17-54" aria-hidden="true" tabindex="-1"></a>    <span class="at">label =</span> name,</span>
<span id="cb17-55"><a href="#cb17-55" aria-hidden="true" tabindex="-1"></a>    <span class="at">value =</span> scales<span class="sc">::</span><span class="fu">rescale</span>(degree, <span class="at">to =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">25</span>)),  <span class="co"># Size by degree</span></span>
<span id="cb17-56"><a href="#cb17-56" aria-hidden="true" tabindex="-1"></a>    <span class="at">group =</span> sub_type,</span>
<span id="cb17-57"><a href="#cb17-57" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="fu">case_when</span>(</span>
<span id="cb17-58"><a href="#cb17-58" aria-hidden="true" tabindex="-1"></a>    sub_type <span class="sc">==</span> <span class="st">"Person"</span>       <span class="sc">~</span> <span class="st">"orange"</span>,</span>
<span id="cb17-59"><a href="#cb17-59" aria-hidden="true" tabindex="-1"></a>    sub_type <span class="sc">==</span> <span class="st">"Vessel"</span>       <span class="sc">~</span> <span class="st">"forestgreen"</span>,</span>
<span id="cb17-60"><a href="#cb17-60" aria-hidden="true" tabindex="-1"></a>    sub_type <span class="sc">==</span> <span class="st">"Organization"</span> <span class="sc">~</span> <span class="st">"pink"</span>,</span>
<span id="cb17-61"><a href="#cb17-61" aria-hidden="true" tabindex="-1"></a>    sub_type <span class="sc">==</span> <span class="st">"Group"</span>        <span class="sc">~</span> <span class="st">"blue"</span>,</span>
<span id="cb17-62"><a href="#cb17-62" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"lightgray"</span></span>
<span id="cb17-63"><a href="#cb17-63" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb17-64"><a href="#cb17-64" aria-hidden="true" tabindex="-1"></a>    <span class="at">shape =</span> <span class="fu">case_when</span>(</span>
<span id="cb17-65"><a href="#cb17-65" aria-hidden="true" tabindex="-1"></a>    sub_type <span class="sc">==</span> <span class="st">"Person"</span>       <span class="sc">~</span> <span class="st">"dot"</span>,</span>
<span id="cb17-66"><a href="#cb17-66" aria-hidden="true" tabindex="-1"></a>    sub_type <span class="sc">==</span> <span class="st">"Vessel"</span>       <span class="sc">~</span> <span class="st">"triangle"</span>,</span>
<span id="cb17-67"><a href="#cb17-67" aria-hidden="true" tabindex="-1"></a>    sub_type <span class="sc">==</span> <span class="st">"Organization"</span> <span class="sc">~</span> <span class="st">"box"</span>,</span>
<span id="cb17-68"><a href="#cb17-68" aria-hidden="true" tabindex="-1"></a>    sub_type <span class="sc">==</span> <span class="st">"Group"</span>        <span class="sc">~</span> <span class="st">"star"</span>,</span>
<span id="cb17-69"><a href="#cb17-69" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"ellipse"</span></span>
<span id="cb17-70"><a href="#cb17-70" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb17-71"><a href="#cb17-71" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="fu">paste0</span>(</span>
<span id="cb17-72"><a href="#cb17-72" aria-hidden="true" tabindex="-1"></a>      <span class="st">"&lt;b&gt;"</span>, name, <span class="st">"&lt;/b&gt;&lt;br&gt;"</span>,</span>
<span id="cb17-73"><a href="#cb17-73" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Degree: "</span>, degree, <span class="st">"&lt;br&gt;"</span>,</span>
<span id="cb17-74"><a href="#cb17-74" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Betweenness: "</span>, <span class="fu">round</span>(betweenness, <span class="dv">2</span>), <span class="st">"&lt;br&gt;"</span>,</span>
<span id="cb17-75"><a href="#cb17-75" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Closeness: "</span>, <span class="fu">round</span>(closeness, <span class="dv">3</span>), <span class="st">"&lt;br&gt;"</span>,</span>
<span id="cb17-76"><a href="#cb17-76" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Eigenvector: "</span>, <span class="fu">round</span>(eigen, <span class="dv">3</span>)</span>
<span id="cb17-77"><a href="#cb17-77" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb17-78"><a href="#cb17-78" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb17-79"><a href="#cb17-79" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id, label, group, shape, color, value, title)</span>
<span id="cb17-80"><a href="#cb17-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-81"><a href="#cb17-81" aria-hidden="true" tabindex="-1"></a>vis_edges <span class="ot">&lt;-</span> edges_final <span class="sc">%&gt;%</span></span>
<span id="cb17-82"><a href="#cb17-82" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">arrows =</span> <span class="st">"none"</span>, <span class="at">color =</span> <span class="st">"gray"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb17-83"><a href="#cb17-83" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>()</span>
<span id="cb17-84"><a href="#cb17-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-85"><a href="#cb17-85" aria-hidden="true" tabindex="-1"></a><span class="fu">visNetwork</span>(vis_nodes, vis_edges) <span class="sc">%&gt;%</span></span>
<span id="cb17-86"><a href="#cb17-86" aria-hidden="true" tabindex="-1"></a>  <span class="fu">visNodes</span>(<span class="at">font =</span> <span class="fu">list</span>(<span class="at">size =</span> <span class="dv">16</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb17-87"><a href="#cb17-87" aria-hidden="true" tabindex="-1"></a>  <span class="fu">visEdges</span>(<span class="at">smooth =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb17-88"><a href="#cb17-88" aria-hidden="true" tabindex="-1"></a>  <span class="fu">visOptions</span>(</span>
<span id="cb17-89"><a href="#cb17-89" aria-hidden="true" tabindex="-1"></a>    <span class="at">highlightNearest =</span> <span class="fu">list</span>(<span class="at">enabled =</span> <span class="cn">TRUE</span>, <span class="at">degree =</span> <span class="dv">1</span>, <span class="at">hover =</span> <span class="cn">TRUE</span>),</span>
<span id="cb17-90"><a href="#cb17-90" aria-hidden="true" tabindex="-1"></a>    <span class="at">nodesIdSelection =</span> <span class="cn">TRUE</span></span>
<span id="cb17-91"><a href="#cb17-91" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb17-92"><a href="#cb17-92" aria-hidden="true" tabindex="-1"></a>  <span class="fu">visLayout</span>(<span class="at">randomSeed =</span> <span class="dv">42</span>) <span class="sc">%&gt;%</span></span>
<span id="cb17-93"><a href="#cb17-93" aria-hidden="true" tabindex="-1"></a>  <span class="fu">visLegend</span>(<span class="at">addNodes =</span> <span class="fu">data.frame</span>(</span>
<span id="cb17-94"><a href="#cb17-94" aria-hidden="true" tabindex="-1"></a>  <span class="at">label =</span> <span class="fu">c</span>(<span class="st">"Person"</span>, <span class="st">"Vessel"</span>, <span class="st">"Organization"</span>, <span class="st">"Group"</span>),</span>
<span id="cb17-95"><a href="#cb17-95" aria-hidden="true" tabindex="-1"></a>  <span class="at">shape =</span> <span class="fu">c</span>(<span class="st">"dot"</span>, <span class="st">"triangle"</span>, <span class="st">"box"</span>, <span class="st">"star"</span>),</span>
<span id="cb17-96"><a href="#cb17-96" aria-hidden="true" tabindex="-1"></a>  <span class="at">color =</span> <span class="fu">c</span>(<span class="st">"orange"</span>, <span class="st">"forestgreen"</span>, <span class="st">"pink"</span>, <span class="st">"blue"</span>)</span>
<span id="cb17-97"><a href="#cb17-97" aria-hidden="true" tabindex="-1"></a>), <span class="at">useGroups =</span> <span class="cn">FALSE</span>, <span class="at">position =</span> <span class="st">"right"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="visNetwork html-widget html-fill-item" id="htmlwidget-7ba58626d448577d6c70" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-7ba58626d448577d6c70">{"x":{"nodes":{"id":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37],"label":["Sam","Kelly","Nadia Conti","Elise","Liam Thorne","Samantha Blake","Davis","Rodriguez","Clepper Jensen","Miranda Jordan","The Intern","The Lookout","The Accountant","Mrs. Money","The Middleman","Boss","Small Fry","Glitters Team","Oceanus City Council","Green Guardians","V. Miesel Shipping","Sailor Shifts Team","Neptune","Marlin","Serenity","Mako","Reef Guardian","Horizon","Seawatch","EcoVigil","Sentinel","Osprey","Defender","Northern Light","Remora","Knowles","City Officials"],"group":["Person","Person","Person","Person","Person","Person","Person","Person","Person","Person","Person","Person","Person","Person","Person","Person","Person","Organization","Organization","Organization","Organization","Organization","Vessel","Vessel","Vessel","Vessel","Vessel","Vessel","Vessel","Vessel","Vessel","Vessel","Vessel","Vessel","Vessel","Vessel","Group"],"shape":["dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","box","box","box","box","box","triangle","triangle","triangle","triangle","triangle","triangle","triangle","triangle","triangle","triangle","triangle","triangle","triangle","triangle","star"],"color":["orange","orange","orange","orange","orange","orange","orange","orange","orange","orange","orange","orange","orange","orange","orange","orange","orange","pink","pink","pink","pink","pink","forestgreen","forestgreen","forestgreen","forestgreen","forestgreen","forestgreen","forestgreen","forestgreen","forestgreen","forestgreen","forestgreen","forestgreen","forestgreen","forestgreen","blue"],"value":[6.052631578947368,5,15.52631578947368,9.210526315789473,10.26315789473684,8.157894736842106,13.42105263157895,11.31578947368421,5,5,6.052631578947368,10.26315789473684,6.052631578947368,12.36842105263158,8.157894736842106,13.42105263157895,7.105263157894736,8.157894736842106,15.52631578947368,13.42105263157895,13.42105263157895,10.26315789473684,14.47368421052632,9.210526315789473,7.105263157894736,25,16.57894736842105,12.36842105263158,9.210526315789473,10.26315789473684,13.42105263157895,5,7.105263157894736,8.157894736842106,15.52631578947368,6.052631578947368,5],"title":["<b>Sam<\/b><br>Degree: 4<br>Betweenness: 33<br>Closeness: 0.009<br>Eigenvector: 0.032","<b>Kelly<\/b><br>Degree: 2<br>Betweenness: 0<br>Closeness: 0.007<br>Eigenvector: 0.004","<b>Nadia Conti<\/b><br>Degree: 22<br>Betweenness: 30.16<br>Closeness: 0.016<br>Eigenvector: 0.635","<b>Elise<\/b><br>Degree: 10<br>Betweenness: 3.24<br>Closeness: 0.014<br>Eigenvector: 0.365","<b>Liam Thorne<\/b><br>Degree: 12<br>Betweenness: 16.03<br>Closeness: 0.013<br>Eigenvector: 0.3","<b>Samantha Blake<\/b><br>Degree: 8<br>Betweenness: 3.87<br>Closeness: 0.013<br>Eigenvector: 0.253","<b>Davis<\/b><br>Degree: 18<br>Betweenness: 13.62<br>Closeness: 0.014<br>Eigenvector: 0.555","<b>Rodriguez<\/b><br>Degree: 14<br>Betweenness: 4.41<br>Closeness: 0.013<br>Eigenvector: 0.428","<b>Clepper Jensen<\/b><br>Degree: 2<br>Betweenness: 0<br>Closeness: 1<br>Eigenvector: 0","<b>Miranda Jordan<\/b><br>Degree: 2<br>Betweenness: 0<br>Closeness: 1<br>Eigenvector: 0","<b>The Intern<\/b><br>Degree: 4<br>Betweenness: 9.9<br>Closeness: 0.012<br>Eigenvector: 0.085","<b>The Lookout<\/b><br>Degree: 12<br>Betweenness: 73.17<br>Closeness: 0.013<br>Eigenvector: 0.275","<b>The Accountant<\/b><br>Degree: 4<br>Betweenness: 0<br>Closeness: 0.01<br>Eigenvector: 0.067","<b>Mrs. Money<\/b><br>Degree: 16<br>Betweenness: 40.49<br>Closeness: 0.015<br>Eigenvector: 0.457","<b>The Middleman<\/b><br>Degree: 8<br>Betweenness: 4.95<br>Closeness: 0.012<br>Eigenvector: 0.146","<b>Boss<\/b><br>Degree: 18<br>Betweenness: 49.3<br>Closeness: 0.015<br>Eigenvector: 0.433","<b>Small Fry<\/b><br>Degree: 6<br>Betweenness: 0<br>Closeness: 0.013<br>Eigenvector: 0.255","<b>Glitters Team<\/b><br>Degree: 8<br>Betweenness: 6.38<br>Closeness: 0.012<br>Eigenvector: 0.177","<b>Oceanus City Council<\/b><br>Degree: 22<br>Betweenness: 30.58<br>Closeness: 0.016<br>Eigenvector: 0.629","<b>Green Guardians<\/b><br>Degree: 18<br>Betweenness: 30.77<br>Closeness: 0.016<br>Eigenvector: 0.521","<b>V. Miesel Shipping<\/b><br>Degree: 18<br>Betweenness: 6.69<br>Closeness: 0.015<br>Eigenvector: 0.595","<b>Sailor Shifts Team<\/b><br>Degree: 12<br>Betweenness: 9.55<br>Closeness: 0.014<br>Eigenvector: 0.366","<b>Neptune<\/b><br>Degree: 20<br>Betweenness: 46.82<br>Closeness: 0.016<br>Eigenvector: 0.609","<b>Marlin<\/b><br>Degree: 10<br>Betweenness: 2.22<br>Closeness: 0.014<br>Eigenvector: 0.414","<b>Serenity<\/b><br>Degree: 6<br>Betweenness: 0<br>Closeness: 0.013<br>Eigenvector: 0.264","<b>Mako<\/b><br>Degree: 40<br>Betweenness: 197.62<br>Closeness: 0.02<br>Eigenvector: 1","<b>Reef Guardian<\/b><br>Degree: 24<br>Betweenness: 56.41<br>Closeness: 0.016<br>Eigenvector: 0.658","<b>Horizon<\/b><br>Degree: 16<br>Betweenness: 15.28<br>Closeness: 0.015<br>Eigenvector: 0.501","<b>Seawatch<\/b><br>Degree: 10<br>Betweenness: 1.24<br>Closeness: 0.012<br>Eigenvector: 0.287","<b>EcoVigil<\/b><br>Degree: 12<br>Betweenness: 5.05<br>Closeness: 0.013<br>Eigenvector: 0.369","<b>Sentinel<\/b><br>Degree: 18<br>Betweenness: 28.42<br>Closeness: 0.016<br>Eigenvector: 0.567","<b>Osprey<\/b><br>Degree: 2<br>Betweenness: 0<br>Closeness: 0.012<br>Eigenvector: 0.116","<b>Defender<\/b><br>Degree: 6<br>Betweenness: 2.27<br>Closeness: 0.013<br>Eigenvector: 0.226","<b>Northern Light<\/b><br>Degree: 8<br>Betweenness: 8.89<br>Closeness: 0.012<br>Eigenvector: 0.197","<b>Remora<\/b><br>Degree: 22<br>Betweenness: 24.68<br>Closeness: 0.015<br>Eigenvector: 0.638","<b>Knowles<\/b><br>Degree: 4<br>Betweenness: 0<br>Closeness: 0.012<br>Eigenvector: 0.181","<b>City Officials<\/b><br>Degree: 2<br>Betweenness: 0<br>Closeness: 0.01<br>Eigenvector: 0.071"]},"edges":{"from":[16,7,16,18,16,5,16,26,16,14,16,8,16,13,16,15,16,21,37,23,9,10,7,36,7,26,7,3,7,23,7,35,7,8,7,17,7,21,33,26,33,27,33,29,30,20,30,28,30,5,30,19,30,27,30,31,4,5,4,26,4,3,4,23,4,21,18,34,18,35,18,6,20,28,20,26,20,34,20,19,20,27,20,29,20,31,20,12,28,26,28,19,28,27,28,29,28,31,28,12,2,1,36,26,5,3,5,19,5,15,26,24,26,14,26,23,26,19,26,32,26,27,26,35,26,22,26,6,26,31,26,25,26,17,26,21,24,3,24,19,24,27,24,35,14,23,14,35,14,8,14,11,14,15,14,21,3,23,3,19,3,35,3,8,3,22,3,31,3,21,23,27,23,35,23,25,23,21,34,19,34,22,19,27,19,6,19,31,27,29,27,31,27,25,27,12,35,8,35,22,35,17,35,21,8,22,8,21,22,6,1,12,29,31,31,12,13,15,11,12],"to":[7,16,18,16,5,16,26,16,14,16,8,16,13,16,15,16,21,16,23,37,10,9,36,7,26,7,3,7,23,7,35,7,8,7,17,7,21,7,26,33,27,33,29,33,20,30,28,30,5,30,19,30,27,30,31,30,5,4,26,4,3,4,23,4,21,4,34,18,35,18,6,18,28,20,26,20,34,20,19,20,27,20,29,20,31,20,12,20,26,28,19,28,27,28,29,28,31,28,12,28,1,2,26,36,3,5,19,5,15,5,24,26,14,26,23,26,19,26,32,26,27,26,35,26,22,26,6,26,31,26,25,26,17,26,21,26,3,24,19,24,27,24,35,24,23,14,35,14,8,14,11,14,15,14,21,14,23,3,19,3,35,3,8,3,22,3,31,3,21,3,27,23,35,23,25,23,21,23,19,34,22,34,27,19,6,19,31,19,29,27,31,27,25,27,12,27,8,35,22,35,17,35,21,35,22,8,21,8,6,22,12,1,31,29,12,31,15,13,12,11],"weight":[1,1,1,1,1,1,3,3,10,10,3,3,2,2,7,7,2,2,1,1,38,38,2,2,6,6,5,5,3,3,5,5,3,3,2,2,3,3,1,1,5,5,1,1,3,3,8,8,3,3,2,2,6,6,2,2,2,2,1,1,3,3,3,3,2,2,1,1,1,1,1,1,6,6,2,2,2,2,18,18,6,6,3,3,3,3,3,3,1,1,1,1,4,4,2,2,9,9,5,5,3,3,1,1,4,4,14,14,2,2,2,2,1,1,10,10,3,3,8,8,4,4,14,14,1,1,7,7,9,9,3,3,1,1,2,2,1,1,2,2,4,4,2,2,2,2,1,1,1,1,20,20,6,6,2,2,3,3,2,2,1,1,1,1,1,1,1,1,2,2,2,2,15,15,3,3,12,12,2,2,1,1,6,6,5,5,3,3,4,4,4,4,5,5,1,1,2,2,3,3,4,4,3,3,1,1,1,1,3,3,8,8,1,1,4,4,4,4,20,20],"arrows":["none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none"],"color":["gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray"]},"nodesToDataframe":true,"edgesToDataframe":true,"options":{"width":"100%","height":"100%","nodes":{"shape":"dot","font":{"size":16}},"manipulation":{"enabled":false},"edges":{"smooth":false},"interaction":{"hover":true,"zoomSpeed":1},"layout":{"randomSeed":42}},"groups":["Person","Organization","Vessel","Group"],"width":null,"height":null,"idselection":{"enabled":true,"style":"width: 150px; height: 26px","useLabels":true,"main":"Select by id"},"byselection":{"enabled":false,"style":"width: 150px; height: 26px","multiple":false,"hideColor":"rgba(200,200,200,0.5)","highlight":false},"main":null,"submain":null,"footer":null,"background":"rgba(0, 0, 0, 0)","tooltipStay":300,"tooltipStyle":"position: fixed;visibility:hidden;padding: 5px;white-space: nowrap;font-family: verdana;font-size:14px;font-color:#000000;background-color: #f5f4ed;-moz-border-radius: 3px;-webkit-border-radius: 3px;border-radius: 3px;border: 1px solid #808074;box-shadow: 3px 3px 10px rgba(0, 0, 0, 0.2);","highlight":{"enabled":true,"hoverNearest":true,"degree":1,"algorithm":"all","hideColor":"rgba(200,200,200,0.5)","labelOnly":true},"collapse":{"enabled":false,"fit":false,"resetHighlight":true,"clusterOptions":null,"keepCoord":true,"labelSuffix":"(cluster)"},"legend":{"width":0.2,"useGroups":false,"position":"right","ncol":1,"stepX":100,"stepY":100,"zoom":true,"nodes":{"label":["Person","Vessel","Organization","Group"],"shape":["dot","triangle","box","star"],"color":["orange","forestgreen","pink","blue"]},"nodesToDataframe":true}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 1: Convert to igraph</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>g_igraph <span class="ot">&lt;-</span> igraph<span class="sc">::</span><span class="fu">graph_from_data_frame</span>(</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">d =</span> vis_edges <span class="sc">%&gt;%</span> <span class="fu">select</span>(from, to),</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">vertices =</span> vis_nodes <span class="sc">%&gt;%</span> <span class="fu">select</span>(id, label),</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">directed =</span> <span class="cn">FALSE</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 2: Apply clustering</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>clustering_method <span class="ot">&lt;-</span> <span class="st">"label_prop"</span>  <span class="co"># options: "louvain", "label_prop"</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>clusters <span class="ot">&lt;-</span> <span class="cf">switch</span>(</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>  clustering_method,</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">louvain     =</span> <span class="fu">cluster_louvain</span>(g_igraph),</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">label_prop  =</span> <span class="fu">cluster_label_prop</span>(g_igraph),</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stop</span>(<span class="st">"Unsupported clustering method"</span>)</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>membership_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">id =</span> <span class="fu">names</span>(<span class="fu">membership</span>(clusters)),</span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">cluster_id =</span> <span class="fu">membership</span>(clusters),</span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span></span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 3: Merge with vis_nodes and color by cluster</span></span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a>n_clusters <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">unique</span>(membership_df<span class="sc">$</span>cluster_id))</span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a>palette <span class="ot">&lt;-</span> RColorBrewer<span class="sc">::</span><span class="fu">brewer.pal</span>(<span class="fu">max</span>(<span class="dv">3</span>, <span class="fu">min</span>(<span class="dv">8</span>, n_clusters)), <span class="st">"Set2"</span>)</span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a>vis_nodes_clustered <span class="ot">&lt;-</span> vis_nodes <span class="sc">%&gt;%</span></span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">id =</span> <span class="fu">as.character</span>(id)) <span class="sc">%&gt;%</span></span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(membership_df, <span class="at">by =</span> <span class="st">"id"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb18-32"><a href="#cb18-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">group =</span> <span class="fu">paste0</span>(<span class="st">"Cluster "</span>, cluster_id),</span>
<span id="cb18-33"><a href="#cb18-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> palette[<span class="fu">as.numeric</span>(<span class="fu">factor</span>(cluster_id))]</span>
<span id="cb18-34"><a href="#cb18-34" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb18-35"><a href="#cb18-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-36"><a href="#cb18-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Optional legend</span></span>
<span id="cb18-37"><a href="#cb18-37" aria-hidden="true" tabindex="-1"></a>legend_data <span class="ot">&lt;-</span> vis_nodes_clustered <span class="sc">%&gt;%</span></span>
<span id="cb18-38"><a href="#cb18-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(group, color) <span class="sc">%&gt;%</span></span>
<span id="cb18-39"><a href="#cb18-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">label =</span> group, <span class="at">shape =</span> <span class="st">"dot"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb18-40"><a href="#cb18-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(label, shape, color)</span>
<span id="cb18-41"><a href="#cb18-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-42"><a href="#cb18-42" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 4: Visualize with clustering</span></span>
<span id="cb18-43"><a href="#cb18-43" aria-hidden="true" tabindex="-1"></a><span class="fu">visNetwork</span>(vis_nodes_clustered, vis_edges) <span class="sc">%&gt;%</span></span>
<span id="cb18-44"><a href="#cb18-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">visNodes</span>(<span class="at">font =</span> <span class="fu">list</span>(<span class="at">size =</span> <span class="dv">16</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb18-45"><a href="#cb18-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">visEdges</span>(<span class="at">smooth =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb18-46"><a href="#cb18-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">visOptions</span>(</span>
<span id="cb18-47"><a href="#cb18-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">highlightNearest =</span> <span class="fu">list</span>(<span class="at">enabled =</span> <span class="cn">TRUE</span>, <span class="at">degree =</span> <span class="dv">1</span>, <span class="at">hover =</span> <span class="cn">TRUE</span>),</span>
<span id="cb18-48"><a href="#cb18-48" aria-hidden="true" tabindex="-1"></a>    <span class="at">nodesIdSelection =</span> <span class="cn">TRUE</span></span>
<span id="cb18-49"><a href="#cb18-49" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb18-50"><a href="#cb18-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">visLegend</span>(</span>
<span id="cb18-51"><a href="#cb18-51" aria-hidden="true" tabindex="-1"></a>    <span class="at">addNodes =</span> legend_data,</span>
<span id="cb18-52"><a href="#cb18-52" aria-hidden="true" tabindex="-1"></a>    <span class="at">useGroups =</span> <span class="cn">FALSE</span>,</span>
<span id="cb18-53"><a href="#cb18-53" aria-hidden="true" tabindex="-1"></a>    <span class="at">position =</span> <span class="st">"right"</span></span>
<span id="cb18-54"><a href="#cb18-54" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb18-55"><a href="#cb18-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">visLayout</span>(<span class="at">randomSeed =</span> <span class="dv">42</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="visNetwork html-widget html-fill-item" id="htmlwidget-40f92511009264e0ecec" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-40f92511009264e0ecec">{"x":{"nodes":{"id":["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37"],"label":["Sam","Kelly","Nadia Conti","Elise","Liam Thorne","Samantha Blake","Davis","Rodriguez","Clepper Jensen","Miranda Jordan","The Intern","The Lookout","The Accountant","Mrs. Money","The Middleman","Boss","Small Fry","Glitters Team","Oceanus City Council","Green Guardians","V. Miesel Shipping","Sailor Shifts Team","Neptune","Marlin","Serenity","Mako","Reef Guardian","Horizon","Seawatch","EcoVigil","Sentinel","Osprey","Defender","Northern Light","Remora","Knowles","City Officials"],"group":["Cluster 1","Cluster 1","Cluster 2","Cluster 2","Cluster 2","Cluster 2","Cluster 2","Cluster 2","Cluster 3","Cluster 3","Cluster 2","Cluster 1","Cluster 2","Cluster 2","Cluster 2","Cluster 2","Cluster 2","Cluster 2","Cluster 2","Cluster 1","Cluster 2","Cluster 2","Cluster 2","Cluster 2","Cluster 2","Cluster 2","Cluster 1","Cluster 1","Cluster 1","Cluster 1","Cluster 1","Cluster 2","Cluster 1","Cluster 2","Cluster 2","Cluster 2","Cluster 2"],"shape":["dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","dot","box","box","box","box","box","triangle","triangle","triangle","triangle","triangle","triangle","triangle","triangle","triangle","triangle","triangle","triangle","triangle","triangle","star"],"color":["#66C2A5","#66C2A5","#FC8D62","#FC8D62","#FC8D62","#FC8D62","#FC8D62","#FC8D62","#8DA0CB","#8DA0CB","#FC8D62","#66C2A5","#FC8D62","#FC8D62","#FC8D62","#FC8D62","#FC8D62","#FC8D62","#FC8D62","#66C2A5","#FC8D62","#FC8D62","#FC8D62","#FC8D62","#FC8D62","#FC8D62","#66C2A5","#66C2A5","#66C2A5","#66C2A5","#66C2A5","#FC8D62","#66C2A5","#FC8D62","#FC8D62","#FC8D62","#FC8D62"],"value":[6.052631578947368,5,15.52631578947368,9.210526315789473,10.26315789473684,8.157894736842106,13.42105263157895,11.31578947368421,5,5,6.052631578947368,10.26315789473684,6.052631578947368,12.36842105263158,8.157894736842106,13.42105263157895,7.105263157894736,8.157894736842106,15.52631578947368,13.42105263157895,13.42105263157895,10.26315789473684,14.47368421052632,9.210526315789473,7.105263157894736,25,16.57894736842105,12.36842105263158,9.210526315789473,10.26315789473684,13.42105263157895,5,7.105263157894736,8.157894736842106,15.52631578947368,6.052631578947368,5],"title":["<b>Sam<\/b><br>Degree: 4<br>Betweenness: 33<br>Closeness: 0.009<br>Eigenvector: 0.032","<b>Kelly<\/b><br>Degree: 2<br>Betweenness: 0<br>Closeness: 0.007<br>Eigenvector: 0.004","<b>Nadia Conti<\/b><br>Degree: 22<br>Betweenness: 30.16<br>Closeness: 0.016<br>Eigenvector: 0.635","<b>Elise<\/b><br>Degree: 10<br>Betweenness: 3.24<br>Closeness: 0.014<br>Eigenvector: 0.365","<b>Liam Thorne<\/b><br>Degree: 12<br>Betweenness: 16.03<br>Closeness: 0.013<br>Eigenvector: 0.3","<b>Samantha Blake<\/b><br>Degree: 8<br>Betweenness: 3.87<br>Closeness: 0.013<br>Eigenvector: 0.253","<b>Davis<\/b><br>Degree: 18<br>Betweenness: 13.62<br>Closeness: 0.014<br>Eigenvector: 0.555","<b>Rodriguez<\/b><br>Degree: 14<br>Betweenness: 4.41<br>Closeness: 0.013<br>Eigenvector: 0.428","<b>Clepper Jensen<\/b><br>Degree: 2<br>Betweenness: 0<br>Closeness: 1<br>Eigenvector: 0","<b>Miranda Jordan<\/b><br>Degree: 2<br>Betweenness: 0<br>Closeness: 1<br>Eigenvector: 0","<b>The Intern<\/b><br>Degree: 4<br>Betweenness: 9.9<br>Closeness: 0.012<br>Eigenvector: 0.085","<b>The Lookout<\/b><br>Degree: 12<br>Betweenness: 73.17<br>Closeness: 0.013<br>Eigenvector: 0.275","<b>The Accountant<\/b><br>Degree: 4<br>Betweenness: 0<br>Closeness: 0.01<br>Eigenvector: 0.067","<b>Mrs. Money<\/b><br>Degree: 16<br>Betweenness: 40.49<br>Closeness: 0.015<br>Eigenvector: 0.457","<b>The Middleman<\/b><br>Degree: 8<br>Betweenness: 4.95<br>Closeness: 0.012<br>Eigenvector: 0.146","<b>Boss<\/b><br>Degree: 18<br>Betweenness: 49.3<br>Closeness: 0.015<br>Eigenvector: 0.433","<b>Small Fry<\/b><br>Degree: 6<br>Betweenness: 0<br>Closeness: 0.013<br>Eigenvector: 0.255","<b>Glitters Team<\/b><br>Degree: 8<br>Betweenness: 6.38<br>Closeness: 0.012<br>Eigenvector: 0.177","<b>Oceanus City Council<\/b><br>Degree: 22<br>Betweenness: 30.58<br>Closeness: 0.016<br>Eigenvector: 0.629","<b>Green Guardians<\/b><br>Degree: 18<br>Betweenness: 30.77<br>Closeness: 0.016<br>Eigenvector: 0.521","<b>V. Miesel Shipping<\/b><br>Degree: 18<br>Betweenness: 6.69<br>Closeness: 0.015<br>Eigenvector: 0.595","<b>Sailor Shifts Team<\/b><br>Degree: 12<br>Betweenness: 9.55<br>Closeness: 0.014<br>Eigenvector: 0.366","<b>Neptune<\/b><br>Degree: 20<br>Betweenness: 46.82<br>Closeness: 0.016<br>Eigenvector: 0.609","<b>Marlin<\/b><br>Degree: 10<br>Betweenness: 2.22<br>Closeness: 0.014<br>Eigenvector: 0.414","<b>Serenity<\/b><br>Degree: 6<br>Betweenness: 0<br>Closeness: 0.013<br>Eigenvector: 0.264","<b>Mako<\/b><br>Degree: 40<br>Betweenness: 197.62<br>Closeness: 0.02<br>Eigenvector: 1","<b>Reef Guardian<\/b><br>Degree: 24<br>Betweenness: 56.41<br>Closeness: 0.016<br>Eigenvector: 0.658","<b>Horizon<\/b><br>Degree: 16<br>Betweenness: 15.28<br>Closeness: 0.015<br>Eigenvector: 0.501","<b>Seawatch<\/b><br>Degree: 10<br>Betweenness: 1.24<br>Closeness: 0.012<br>Eigenvector: 0.287","<b>EcoVigil<\/b><br>Degree: 12<br>Betweenness: 5.05<br>Closeness: 0.013<br>Eigenvector: 0.369","<b>Sentinel<\/b><br>Degree: 18<br>Betweenness: 28.42<br>Closeness: 0.016<br>Eigenvector: 0.567","<b>Osprey<\/b><br>Degree: 2<br>Betweenness: 0<br>Closeness: 0.012<br>Eigenvector: 0.116","<b>Defender<\/b><br>Degree: 6<br>Betweenness: 2.27<br>Closeness: 0.013<br>Eigenvector: 0.226","<b>Northern Light<\/b><br>Degree: 8<br>Betweenness: 8.89<br>Closeness: 0.012<br>Eigenvector: 0.197","<b>Remora<\/b><br>Degree: 22<br>Betweenness: 24.68<br>Closeness: 0.015<br>Eigenvector: 0.638","<b>Knowles<\/b><br>Degree: 4<br>Betweenness: 0<br>Closeness: 0.012<br>Eigenvector: 0.181","<b>City Officials<\/b><br>Degree: 2<br>Betweenness: 0<br>Closeness: 0.01<br>Eigenvector: 0.071"],"cluster_id":[1,1,2,2,2,2,2,2,3,3,2,1,2,2,2,2,2,2,2,1,2,2,2,2,2,2,1,1,1,1,1,2,1,2,2,2,2]},"edges":{"from":[16,7,16,18,16,5,16,26,16,14,16,8,16,13,16,15,16,21,37,23,9,10,7,36,7,26,7,3,7,23,7,35,7,8,7,17,7,21,33,26,33,27,33,29,30,20,30,28,30,5,30,19,30,27,30,31,4,5,4,26,4,3,4,23,4,21,18,34,18,35,18,6,20,28,20,26,20,34,20,19,20,27,20,29,20,31,20,12,28,26,28,19,28,27,28,29,28,31,28,12,2,1,36,26,5,3,5,19,5,15,26,24,26,14,26,23,26,19,26,32,26,27,26,35,26,22,26,6,26,31,26,25,26,17,26,21,24,3,24,19,24,27,24,35,14,23,14,35,14,8,14,11,14,15,14,21,3,23,3,19,3,35,3,8,3,22,3,31,3,21,23,27,23,35,23,25,23,21,34,19,34,22,19,27,19,6,19,31,27,29,27,31,27,25,27,12,35,8,35,22,35,17,35,21,8,22,8,21,22,6,1,12,29,31,31,12,13,15,11,12],"to":[7,16,18,16,5,16,26,16,14,16,8,16,13,16,15,16,21,16,23,37,10,9,36,7,26,7,3,7,23,7,35,7,8,7,17,7,21,7,26,33,27,33,29,33,20,30,28,30,5,30,19,30,27,30,31,30,5,4,26,4,3,4,23,4,21,4,34,18,35,18,6,18,28,20,26,20,34,20,19,20,27,20,29,20,31,20,12,20,26,28,19,28,27,28,29,28,31,28,12,28,1,2,26,36,3,5,19,5,15,5,24,26,14,26,23,26,19,26,32,26,27,26,35,26,22,26,6,26,31,26,25,26,17,26,21,26,3,24,19,24,27,24,35,24,23,14,35,14,8,14,11,14,15,14,21,14,23,3,19,3,35,3,8,3,22,3,31,3,21,3,27,23,35,23,25,23,21,23,19,34,22,34,27,19,6,19,31,19,29,27,31,27,25,27,12,27,8,35,22,35,17,35,21,35,22,8,21,8,6,22,12,1,31,29,12,31,15,13,12,11],"weight":[1,1,1,1,1,1,3,3,10,10,3,3,2,2,7,7,2,2,1,1,38,38,2,2,6,6,5,5,3,3,5,5,3,3,2,2,3,3,1,1,5,5,1,1,3,3,8,8,3,3,2,2,6,6,2,2,2,2,1,1,3,3,3,3,2,2,1,1,1,1,1,1,6,6,2,2,2,2,18,18,6,6,3,3,3,3,3,3,1,1,1,1,4,4,2,2,9,9,5,5,3,3,1,1,4,4,14,14,2,2,2,2,1,1,10,10,3,3,8,8,4,4,14,14,1,1,7,7,9,9,3,3,1,1,2,2,1,1,2,2,4,4,2,2,2,2,1,1,1,1,20,20,6,6,2,2,3,3,2,2,1,1,1,1,1,1,1,1,2,2,2,2,15,15,3,3,12,12,2,2,1,1,6,6,5,5,3,3,4,4,4,4,5,5,1,1,2,2,3,3,4,4,3,3,1,1,1,1,3,3,8,8,1,1,4,4,4,4,20,20],"arrows":["none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none"],"color":["gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray","gray"]},"nodesToDataframe":true,"edgesToDataframe":true,"options":{"width":"100%","height":"100%","nodes":{"shape":"dot","font":{"size":16}},"manipulation":{"enabled":false},"edges":{"smooth":false},"interaction":{"hover":true,"zoomSpeed":1},"layout":{"randomSeed":42}},"groups":["Cluster 1","Cluster 2","Cluster 3"],"width":null,"height":null,"idselection":{"enabled":true,"style":"width: 150px; height: 26px","useLabels":true,"main":"Select by id"},"byselection":{"enabled":false,"style":"width: 150px; height: 26px","multiple":false,"hideColor":"rgba(200,200,200,0.5)","highlight":false},"main":null,"submain":null,"footer":null,"background":"rgba(0, 0, 0, 0)","tooltipStay":300,"tooltipStyle":"position: fixed;visibility:hidden;padding: 5px;white-space: nowrap;font-family: verdana;font-size:14px;font-color:#000000;background-color: #f5f4ed;-moz-border-radius: 3px;-webkit-border-radius: 3px;border-radius: 3px;border: 1px solid #808074;box-shadow: 3px 3px 10px rgba(0, 0, 0, 0.2);","highlight":{"enabled":true,"hoverNearest":true,"degree":1,"algorithm":"all","hideColor":"rgba(200,200,200,0.5)","labelOnly":true},"collapse":{"enabled":false,"fit":false,"resetHighlight":true,"clusterOptions":null,"keepCoord":true,"labelSuffix":"(cluster)"},"legend":{"width":0.2,"useGroups":false,"position":"right","ncol":1,"stepX":100,"stepY":100,"zoom":true,"nodes":{"label":["Cluster 1","Cluster 2","Cluster 3"],"shape":["dot","dot","dot"],"color":["#66C2A5","#FC8D62","#8DA0CB"]},"nodesToDataframe":true}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Add cluster membership from igraph back into tbl_graph</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>cluster_membership <span class="ot">&lt;-</span> <span class="fu">membership</span>(clusters)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>summary_tbl <span class="ot">&lt;-</span> full_graph <span class="sc">%&gt;%</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cluster =</span> cluster_membership) <span class="sc">%&gt;%</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>    name,</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>    sub_type,</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>    cluster,</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>    degree,</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>    betweenness,</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>    closeness,</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>    eigen</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(cluster, <span class="fu">desc</span>(degree)) <span class="sc">%&gt;%</span></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), <span class="sc">~</span> <span class="fu">round</span>(.x, <span class="dv">3</span>)))  <span class="co"># Round numeric values</span></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(summary_tbl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 37 × 7
   name            sub_type     cluster    degree betweenness closeness eigen
   &lt;chr&gt;           &lt;chr&gt;        &lt;membrshp&gt;  &lt;dbl&gt;       &lt;dbl&gt;     &lt;dbl&gt; &lt;dbl&gt;
 1 Reef Guardian   Vessel       1              24       56.4      0.016 0.658
 2 Green Guardians Organization 1              18       30.8      0.016 0.521
 3 Sentinel        Vessel       1              18       28.4      0.016 0.567
 4 Horizon         Vessel       1              16       15.3      0.015 0.501
 5 The Lookout     Person       1              12       73.2      0.013 0.275
 6 EcoVigil        Vessel       1              12        5.05     0.013 0.369
 7 Seawatch        Vessel       1              10        1.24     0.012 0.287
 8 Defender        Vessel       1               6        2.27     0.013 0.226
 9 Sam             Person       1               4       33        0.009 0.032
10 Kelly           Person       1               2        0        0.007 0.004
# ℹ 27 more rows</code></pre>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>